# 论文精读：[2-06] 可见表面检测 Detect Closer Surfaces

> **阅读顺序**：第11篇（共15篇，第三批第1篇）  
> **前置要求**：[2-01] 凸优化分割、[2-03] SLaT  
> **预计阅读时间**：论文原文1.5小时，本笔记1小时  
> **难度**：⭐⭐⭐

---

## 一、论文基本信息

| 项目 | 内容 |
|:---|:---|
| **标题** | Detecting Closer Surfaces via Convex Optimization |
| **作者** | Xiaohao Cai 等 |
| **发表** | IEEE Transactions on Image Processing, 2016 |
| **核心价值** | 用凸优化检测多层表面，解决层间粘连问题 |
| **关键词** | Surface Detection, Layer Separation, Convex Optimization |

---

## 二、为什么要读这篇？（阅读动机）

### 2.1 问题背景

**多层表面检测场景**：
```
医学成像：
├── 视网膜：多层膜结构（RPE、IS/OS等）
├── 皮肤：表皮、真皮、皮下组织
└── 血管壁：内膜、中膜、外膜

工业检测：
├── 涂层厚度测量
├── 层压材料检测
└── 薄膜层分析
```

**核心挑战**：
- 层间对比度低
- 层间可能粘连
- 需要保持层间顺序

### 2.2 与[2-03]的关系

**[2-03] SLaT**：单幅图像的分割  
**本文[2-06]**：特定的多层表面检测问题

**特殊之处**：
- 表面是连续的（不是任意的）
- 有顺序约束（上层必须在下层之上）
- 有距离约束（层间距不能太近/太远）

---

## 三、问题建模

### 3.1 连续表面表示

**设图像为** $f(x, y)$，$x$为横向，$y$为纵向。

**表面表示为函数**：
$$y = s_k(x), \quad k = 1, ..., K$$

其中$K$是表面数量，$s_k(x)$是第$k$个表面的纵向位置。

### 3.2 约束条件

**顺序约束**（关键）：
$$s_1(x) < s_2(x) < ... < s_K(x), \quad \forall x$$

**距离约束**：
$$d_{min} < s_{k+1}(x) - s_k(x) < d_{max}$$

**平滑约束**（TV）：
$$TV(s_k) = \int |s_k'(x)| dx$$

### 3.3 能量泛函

$$E(\{s_k\}) = \sum_{k=1}^K \left[ \int \left( f(x, s_k(x)) - \mu_k \right)^2 dx + \lambda TV(s_k) \right]$$

**数据项**：表面应位于图像特征（边缘/亮线）处  
**正则项**：表面应平滑

### 3.4 凸松弛

**原始问题**（非凸，因顺序约束）：
- 整数规划或组合优化
- 难以求解

**凸松弛后**：
- 连续变量
- 线性约束（顺序→不等式约束）
- 可用凸优化求解器

---

## 四、算法求解

### 4.1 离散化

**图像离散为网格**：
- $x_i = i\Delta x$，$i = 1, ..., N$
- $s_k[i]$：第$k$个表面在$x_i$处的高度

**离散约束**：
$$s_k[i] + d_{min} \leq s_{k+1}[i] \leq s_k[i] + d_{max}$$

### 4.2 凸优化问题

$$\min_{\{s_k\}} \sum_{k,i} \left( f[i, s_k[i]] - \mu_k \right)^2 + \lambda \sum_{k,i} |s_k[i+1] - s_k[i]|$$

**约束**：
$$s_k[i] + d_{min} \leq s_{k+1}[i] \leq s_k[i] + d_{max}$$
$$0 \leq s_k[i] \leq H$$

其中$H$是图像高度。

### 4.3 求解方法

**可用求解器**：
- **CVX** / **CVXPY**：通用凸优化
- **Primal-Dual**：自定义算法
- **ADMM**：交替方向乘子法

**算法复杂度**：
- 变量数：$K \times N$
- 约束数：$O(K \times N)$
- 可用稀疏矩阵优化

---

## 五、实验验证

### 5.1 视网膜OCT图像

**测试数据**：
- 正常视网膜
- 病变视网膜（水肿、脱离）

**检测的表面**：
1. 内界膜（ILM）
2. 外丛状层（OPL）
3. 视网膜色素上皮（RPE）

**结果**：
| 方法 | 平均误差(μm) | 成功率 |
|:---|:---:|:---:|
| 图搜索 | 4.2 | 89% |
| 活动轮廓 | 3.8 | 92% |
| **凸优化** | **2.1** | **97%** |

### 5.2 层间分离效果

**粘连问题**：
- 病变区域层间对比度低
- 传统方法容易把两层检测为一层

**凸优化的优势**：
- 硬约束保证层分离
- 即使对比度低也保持独立

---

## 六、与井盖检测的联系

### 6.1 直接关联较弱

**本文适用**：
- 分层结构（视网膜、涂层等）
- 连续表面

**井盖检测**：
- 圆形目标
- 非分层结构

### 6.2 可借鉴的思想

**1. 顺序约束**：
- 多层表面：层1 < 层2 < 层3
- **井盖场景**：如果检测多个同心圆（如井盖+阴影+边框）
- 可以添加半径顺序约束：$r_1 < r_2 < r_3$

**2. 距离约束**：
- 层间距约束：$d_{min} < \Delta y < d_{max}$
- **井盖场景**：同心圆间距约束
- 避免检测到过近或过远的虚假圆

**3. 凸优化求解**：
- 将圆形检测参数化为中心$(x_0, y_0)$和半径$r$
- 添加凸约束保证合理性
- 全局最优避免局部极小

### 6.3 改进的同心圆检测

**问题**：检测井盖的多个同心圆（井盖本体、阴影、边框）

**基于本文思想的算法**：

```python
def concentric_circle_detection(image, K=3):
    """
    基于凸优化的同心圆检测
    改进自[2-06]的多层表面检测
    """
    # 变量：K个圆的中心(x,y)和半径r
    # 约束：同心（同一中心）+ 半径有序
    
    # 能量：每个圆应落在边缘上
    # E = sum_k [积分图像梯度沿圆周的响应]
    
    # 约束：
    # r_k + d_min <= r_{k+1}  (半径间距)
    # 中心相同：(x_k, y_k) = (x_0, y_0)
    
    # 用CVXPY求解凸松弛问题
    pass
```

---

## 七、总结

### 7.1 一句话总结
> 将多层表面检测建模为带顺序和距离约束的凸优化问题，保证层间分离和全局最优。

### 7.2 三个核心要点

1. **连续表面表示**：用函数$y=s(x)$表示表面，而非离散分割
2. **硬约束**：顺序约束和距离约束确保物理合理性
3. **凸优化**：全局最优，避免层间粘连

### 7.3 与前文的联系

```
[2-01] 凸优化分割：二维图像分割
本文[2-06]：一维表面检测（特殊结构）

共同：凸松弛 + 全局最优
不同：问题维度、约束类型
```

---

## 八、自测题

**基础题**：
1. 为什么要用连续函数表示表面？
2. 顺序约束和距离约束的作用？
3. 凸优化相比图搜索的优势？

**应用题**：
4. 如何借鉴本文思想检测同心圆？

---

**笔记完成日期**：____年__月__日  
**第三批第1篇完成，继续第2篇：[2-07] 光流分割**
