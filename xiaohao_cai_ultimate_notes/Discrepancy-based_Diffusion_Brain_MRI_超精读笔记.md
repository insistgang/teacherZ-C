# Discrepancy-based Diffusion Brain MRI

> **è¶…ç²¾è¯»ç¬”è®°** | 5-Agentè¾©è®ºåˆ†æžç³»ç»Ÿ
> åˆ†æžæ—¶é—´ï¼š2026-02-16
> arXiv: 2405.04974

---

## ðŸ“‹ è®ºæ–‡å…ƒæ•°æ®

| å±žæ€§ | ä¿¡æ¯ |
|------|------|
| **æ ‡é¢˜** | Discrepancy-based Diffusion Model for Brain MRI Segmentation |
| **ä½œè€…** | Xiaohao Cai et al. |
| **å¹´ä»½** | 2024 |
| **arXiv ID** | 2405.04974 |
| **æœŸåˆŠ/ä¼šè®®** | å¾…å‘è¡¨ |
| **æ–‡ä»¶å** | 2024_2405.04974_Discrepancy-based Diffusion Brain MRI.pdf |
| **PDFè·¯å¾„** | D:\Documents\zx\xiaohao_cai_papers_final\2024_2405.04974_Discrepancy-based Diffusion Brain MRI.pdf |

### ðŸ“ æ‘˜è¦ç¿»è¯‘

æœ¬æ–‡æå‡ºäº†ä¸€ç§åŸºäºŽå·®å¼‚(Discrepancy)çš„æ‰©æ•£æ¨¡åž‹(DDM)ç”¨äºŽè„‘MRIåˆ†å‰²ã€‚ä¼ ç»Ÿæ‰©æ•£æ¨¡åž‹åœ¨åŒ»å­¦å›¾åƒåˆ†å‰²ä¸­é¢ä¸´è®¡ç®—å¤æ‚åº¦é«˜å’Œæ¡ä»¶åŒ–å›°éš¾çš„æŒ‘æˆ˜ã€‚æˆ‘ä»¬é€šè¿‡å¼•å…¥å›¾åƒç‰¹å¾ç©ºé—´çš„discrepancyåº¦é‡æ¥æ¡ä»¶åŒ–åˆ†å‰²æŽ©ç çš„ç”Ÿæˆè¿‡ç¨‹ã€‚DDMé‡‡ç”¨åŒç½‘ç»œæž¶æž„ï¼šå›¾åƒç¼–ç å™¨æå–è§†è§‰ç‰¹å¾ï¼Œåˆ†å‰²è§£ç å™¨é€šè¿‡discrepancyå¼•å¯¼çš„æ‰©æ•£é‡‡æ ·ç”Ÿæˆåˆ†å‰²æŽ©ç ã€‚åœ¨IBSR18å’ŒLPBA40æ•°æ®é›†ä¸Šçš„å®žéªŒè¡¨æ˜Žï¼ŒDDMåœ¨Diceåˆ†æ•°ä¸Šä¼˜äºŽnnU-Netå’Œæ ‡å‡†æ‰©æ•£æ¨¡åž‹ï¼ŒåŒæ—¶æä¾›äº†æ›´ç²¾ç»†çš„è¾¹ç•Œåˆ†å‰²ã€‚

**å…³é”®è¯**: æ‰©æ•£æ¨¡åž‹ã€è„‘MRIåˆ†å‰²ã€å·®å¼‚åº¦é‡ã€åŒ»å­¦å›¾åƒåˆ†æžã€ç”Ÿæˆå¼åˆ†å‰²

---

## 1. ðŸ“„ è®ºæ–‡å…ƒä¿¡æ¯

### 1.1 ç ”ç©¶èƒŒæ™¯

**è„‘MRIåˆ†å‰²çš„é‡è¦æ€§**ï¼š
- è„‘ç–¾ç—…è¯Šæ–­çš„åŸºç¡€ï¼šé˜¿å°”èŒ¨æµ·é»˜ç—…ã€è„‘è‚¿ç˜¤ç­‰
- æ²»ç–—è§„åˆ’å’Œç–—æ•ˆè¯„ä¼°ï¼šéœ€è¦ç²¾ç¡®çš„ä½“ç§¯æµ‹é‡
- ç¥žç»ç§‘å­¦ç ”ç©¶ï¼šè„‘åŒºå½¢æ€åˆ†æž

**ä¼ ç»Ÿåˆ†å‰²æ–¹æ³•çš„å±€é™**ï¼š
- U-Netç³»åˆ—ï¼šéœ€è¦å¤§é‡æ ‡æ³¨æ•°æ®
- å˜åˆ†æ–¹æ³•ï¼šè®¡ç®—å¤æ‚åº¦é«˜ï¼Œå‚æ•°è°ƒä¼˜å›°éš¾
- GANæ–¹æ³•ï¼šè®­ç»ƒä¸ç¨³å®šï¼Œæ¨¡å¼å´©æºƒ

### 1.2 æ‰©æ•£æ¨¡åž‹åœ¨åŒ»å­¦å›¾åƒä¸­çš„æŒ‘æˆ˜

1. **è®¡ç®—å¤æ‚åº¦é«˜**
   - éœ€è¦æ•°ç™¾åˆ°æ•°åƒæ­¥é‡‡æ ·
   - å•å¼ å›¾åƒæŽ¨ç†æ—¶é—´3-5ç§’

2. **æ¡ä»¶åŒ–å›°éš¾**
   - å¦‚ä½•æœ‰æ•ˆèžåˆå›¾åƒä¿¡æ¯
   - ä¿æŒç”Ÿæˆå¤šæ ·æ€§ä¸Žç²¾ç¡®æ€§å¹³è¡¡

3. **æ•°æ®éœ€æ±‚å¤§**
   - åŒ»å­¦å›¾åƒæ ‡æ³¨æˆæœ¬é«˜
   - æ‰©æ•£æ¨¡åž‹é€šå¸¸éœ€è¦å¤§é‡è®­ç»ƒæ•°æ®

---

## 2. ðŸŽ¯ ä¸€å¥è¯æ€»ç»“

**é€šè¿‡discrepancyåº¦é‡çš„æ¡ä»¶åŒ–ç­–ç•¥ï¼Œå°†æ‰©æ•£æ¨¡åž‹åº”ç”¨äºŽè„‘MRIåˆ†å‰²ï¼Œåœ¨è¾¹ç•Œç²¾ç»†åº¦ä¸Šè¶…è¶Šä¼ ç»Ÿåˆ†å‰²æ–¹æ³•ã€‚**

---

## 3. ðŸ”‘ æ ¸å¿ƒåˆ›æ–°ç‚¹

| åˆ›æ–°ç‚¹ | æè¿° | æ„ä¹‰ |
|--------|------|------|
| **Discrepancyæ¡ä»¶åŒ–** | é€šè¿‡ç‰¹å¾ç©ºé—´å·®å¼‚åº¦é‡å¼•å¯¼ç”Ÿæˆ | æ–°é¢–çš„æ¡ä»¶åŒ–ç­–ç•¥ |
| **åŒç½‘ç»œæž¶æž„** | å›¾åƒç¼–ç å™¨ + åˆ†å‰²è§£ç å™¨è”åˆè®­ç»ƒ | ç«¯åˆ°ç«¯ä¼˜åŒ– |
| **åŒ»å­¦å½±åƒç‰¹åŒ–é‡‡æ ·** | é’ˆå¯¹è§£å‰–ç»“æž„ä¸€è‡´æ€§è®¾è®¡ | æé«˜ç”Ÿæˆè´¨é‡ |
| **è¾¹ç•Œç²¾ç»†åˆ†å‰²** | åœ¨å°ç›®æ ‡è¾¹ç•Œä¸Šè¡¨çŽ°ä¼˜å¼‚ | è§£å†³ä¸´åºŠç—›ç‚¹ |

---

## 4. ðŸ“Š èƒŒæ™¯ä¸ŽåŠ¨æœº

### 4.1 æ‰©æ•£æ¨¡åž‹åŸºç¡€

**å‰å‘æ‰©æ•£è¿‡ç¨‹ï¼ˆåŠ å™ªï¼‰**ï¼š
```
q(x_t | x_{t-1}) = N(x_t; âˆš(1-Î²_t)x_{t-1}, Î²_tI)
q(x_t | x_0) = N(x_t; âˆš(á¾±_t)x_0, (1-á¾±_t)I)
```

**åå‘æ‰©æ•£è¿‡ç¨‹ï¼ˆåŽ»å™ªï¼‰**ï¼š
```
p_Î¸(x_{t-1} | x_t) = N(x_{t-1}; Î¼_Î¸(x_t, t), Î£_Î¸(x_t, t))
```

**è®­ç»ƒç›®æ ‡**ï¼š
```
L = E_{x_0, Îµ, t}[||Îµ - Îµ_Î¸(âˆš(á¾±_t)x_0 + âˆš(1-á¾±_t)Îµ, t)||Â²]
```

### 4.2 åŒ»å­¦å›¾åƒåˆ†å‰²çš„ç‰¹æ®Šæ€§

| ç‰¹æ€§ | æè¿° | å¯¹æ¨¡åž‹è¦æ±‚ |
|------|------|-----------|
| è§£å‰–ä¸€è‡´æ€§ | ç›¸é‚»è„‘åŒºæœ‰å›ºå®šç©ºé—´å…³ç³» | ç©ºé—´çº¦æŸ |
| è¾¹ç•Œç²¾ç»†åº¦ | å°è„‘ã€æµ·é©¬ä½“ç­‰ç»“æž„è¾¹ç•Œå¤æ‚ | é«˜åˆ†è¾¨çŽ‡åˆ†å‰² |
| å¼ºåº¦ä¸å‡ | MRIå›¾åƒå­˜åœ¨åç½®åœº | é²æ£’æ€§ |
| å¤šæ¨¡æ€ | T1, T2, FLAIRç­‰ | å¤šé€šé“èžåˆ |

---

## 5. ðŸ’¡ æ–¹æ³•è¯¦è§£

### 5.1 æ•´ä½“æž¶æž„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DDM æž¶æž„å›¾                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  è¾“å…¥: MRIå›¾åƒ x âˆˆ R^{HÃ—WÃ—C}                                     â”‚
â”‚         â†“                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ å›¾åƒç¼–ç å™¨ f^I: ResNet/DenseNet                             â”‚   â”‚
â”‚  â”‚ è¾“å‡º: ç‰¹å¾è¡¨ç¤º z_I = f^I(x) âˆˆ R^{dÃ—hÃ—w}                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â†“                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Discrepancyè®¡ç®—                                            â”‚   â”‚
â”‚  â”‚ D_I(z_I, z_S) = ||z_I - z_S||Â²                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â†“                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ æ¡ä»¶æ‰©æ•£è¿‡ç¨‹                                                â”‚   â”‚
â”‚  â”‚ - Scoreç½‘ç»œ: s_Î¸(x, t, z_I)                               â”‚   â”‚
â”‚  â”‚ - é‡‡æ ·æ­¥æ•°: T                                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â†“                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ åˆ†å‰²è§£ç å™¨ f^S: è½»é‡çº§UPN                                  â”‚   â”‚
â”‚  â”‚ è¾“å‡º: åˆ†å‰²æŽ©ç  y âˆˆ {0,1}^{HÃ—WÃ—K}                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â†“                                                        â”‚
â”‚  è¾“å‡º: åˆ†å‰²æŽ©ç  y                                                 â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 æ ¸å¿ƒæ•°å­¦å…¬å¼

#### 5.2.1 Discrepancyå‡½æ•°

**å®šä¹‰**ï¼š
```
D_I(f^I(x), f^I(y)) = ||f^I(x) - f^I(y)||â‚‚Â²
```

**æ•°å­¦æ€§è´¨**ï¼š
- éžè´Ÿæ€§ï¼šD_I â‰¥ 0
- å¯¹ç§°æ€§ï¼šD_I(a, b) = D_I(b, a)
- ä¸‰è§’ä¸ç­‰å¼ï¼šD_I(a, c) â‰¤ D_I(a, b) + D_I(b, c)

**ç‰¹å¾ç©ºé—´é€‰æ‹©çš„æ„ä¹‰**ï¼š
- é™ç»´ï¼šä»ŽåŽŸå§‹åƒç´ ç©ºé—´åˆ°è¯­ä¹‰ç‰¹å¾ç©ºé—´
- è¯­ä¹‰å¯¹é½ï¼šåŒä¸€è¯­ä¹‰åŒºåŸŸç‰¹å¾æŽ¥è¿‘
- è®¡ç®—é«˜æ•ˆï¼šç›¸æ¯”åƒç´ ç©ºé—´è®¡ç®—é‡æ›´å°

#### 5.2.2 æ¡ä»¶æ¦‚çŽ‡æ˜ å°„

**ä»Ždiscrepancyåˆ°æ¦‚çŽ‡**ï¼š
```
p_Î¸(y|x) âˆ exp(-D_I(f^I(x), f^I(y))/ÏƒÂ²)
```

è¿™æ˜¯çŽ»å°”å…¹æ›¼åˆ†å¸ƒå½¢å¼ï¼Œåœ¨ç»Ÿè®¡ç‰©ç†ä¸­æœ‰åšå®žåŸºç¡€ã€‚

**å‚æ•°Ïƒçš„å½±å“**ï¼š
- Ïƒ â†’ 0ï¼šç¡¬æ¡ä»¶åŒ–ï¼Œåªè€ƒè™‘discrepancyæœ€å°çš„æ ·æœ¬
- Ïƒ â†’ âˆžï¼šæ— æ¡ä»¶åŒ–ï¼Œå¿½ç•¥discrepancyä¿¡æ¯
- Ïƒé€‚ä¸­ï¼šå¹³è¡¡å¤šæ ·æ€§ä¸Žç²¾ç¡®æ€§

#### 5.2.3 æ‰©æ•£è¿‡ç¨‹å®šä¹‰

**å‰å‘SDEï¼ˆæ–¹å·®ä¿æŒVP-SDEï¼‰**ï¼š
```
dx = -Â½Î²_t x dt + âˆšÎ²_t dw

å…¶ä¸­ï¼š
- x: éšæœºå˜é‡ï¼ˆåˆ†å‰²æŽ©ç ï¼‰
- Î²_t: å™ªå£°è°ƒåº¦å‚æ•°
- dw: ç»´çº³è¿‡ç¨‹å¢žé‡
```

**ç¦»æ•£åŒ–**ï¼š
```
x_{t-1} = (1/âˆš(1-Î²_t)) (x_t - (Î²_t/(1-âˆš(1-Î²_t))) Îµ_Î¸(x_t, t))
```

#### 5.2.4 è”åˆè®­ç»ƒç›®æ ‡

**æ€»æŸå¤±å‡½æ•°**ï¼š
```
L_total = L_diff + Î» L_disc

å…¶ä¸­ï¼š
L_diff = E[||Îµ - Îµ_Î¸(x_t, t, z_I)||Â²]
L_disc = E[D_I(f^I(x), f^S(y))]
Î»: å¹³è¡¡å‚æ•°
```

### 5.3 å…³é”®ç®—æ³•å®žçŽ°

#### 5.3.1 DDMè®­ç»ƒç®—æ³•

```python
class DDMModel(nn.Module):
    def __init__(self, in_channels=1, num_classes=4):
        super().__init__()

        # å›¾åƒç¼–ç å™¨
        self.image_encoder = ResNet18(in_channels)
        self feat_dim = 256

        # Scoreç½‘ç»œï¼ˆU-Netç»“æž„ï¼‰
        self.score_net = UNet(
            in_channels=num_classes,
            time_emb_dim=128,
            cond_dim=self.feat_dim
        )

        # åˆ†å‰²è§£ç å™¨
        self.seg_decoder = LightUPN(
            in_channels=self.feat_dim,
            num_classes=num_classes
        )

    def forward(self, x, y=None, t=None):
        # ç¼–ç å›¾åƒ
        z_I = self.image_encoder(x)

        if y is None:  # è®­ç»ƒæ¨¡å¼
            return z_I

        # è®¡ç®—discrepancy
        z_S = self.seg_decoder.encode(y)
        disc = torch.sum((z_I - z_S)**2, dim=1, keepdim=True)

        return self.score_net(y, t, z_I), disc

    def sample(self, x, num_steps=100):
        """DDIMé‡‡æ ·"""
        z_I = self.image_encoder(x)

        # åˆå§‹åŒ–å™ªå£°
        y = torch.randn(x.shape[0], self.num_classes,
                        *x.shape[2:])

        # åå‘æ‰©æ•£é‡‡æ ·
        for i, t in enumerate(reversed(range(num_steps))):
            # é¢„æµ‹å™ªå£°
            noise_pred = self.score_net(y, t, z_I)

            # DDIMæ›´æ–°
            y = ddim_step(y, noise_pred, t, num_steps)

        # è§£ç å¾—åˆ°æœ€ç»ˆåˆ†å‰²
        y = self.seg_decoder.decode(y, z_I)

        return y
```

#### 5.3.2 DDIMé‡‡æ ·ä¼˜åŒ–

```python
def ddim_step(x_t, noise_pred, t, num_steps, eta=0.0):
    """
    DDIMé‡‡æ ·æ­¥éª¤

    å‚æ•°:
        x_t: å½“å‰æ—¶åˆ»çš„æ ·æœ¬
        noise_pred: é¢„æµ‹çš„å™ªå£°
        t: å½“å‰æ—¶åˆ»
        num_steps: æ€»é‡‡æ ·æ­¥æ•°
        eta: éšæœºæ€§å‚æ•° (0=ç¡®å®šæ€§, 1=DDPM)
    """
    # èŽ·å–alphaå€¼
    alpha_t = alpha_schedule[t]
    alpha_prev = alpha_schedule[t-1] if t > 0 else 1.0

    # é¢„æµ‹x_0
    x_0_pred = (x_t - np.sqrt(1 - alpha_t) * noise_pred) / np.sqrt(alpha_t)

    # è®¡ç®—x_{t-1}
    dir_xt = np.sqrt(1 - alpha_prev) * noise_pred
    random_noise = eta * np.sqrt(1 - alpha_prev) * torch.randn_like(x_t)
    x_prev = np.sqrt(alpha_prev) * x_0_pred + dir_xt + random_noise

    return x_prev
```

### 5.4 æŸå¤±å‡½æ•°è®¾è®¡

**æ‰©æ•£æŸå¤±**ï¼š
```python
def diffusion_loss(score_net, x_0, t, z_I):
    """æ ‡å‡†æ‰©æ•£æŸå¤±"""
    # æ·»åŠ å™ªå£°
    epsilon = torch.randn_like(x_0)
    x_t = sqrt_alpha_t * x_0 + sqrt_one_minus_alpha_t * epsilon

    # é¢„æµ‹å™ªå£°
    epsilon_pred = score_net(x_t, t, z_I)

    # MSEæŸå¤±
    loss = F.mse_loss(epsilon_pred, epsilon)
    return loss
```

**DiscrepancyæŸå¤±**ï¼š
```python
def discrepancy_loss(f_I, f_S, x, y):
    """Discrepancyä¸€è‡´æ€§æŸå¤±"""
    z_I = f_I(x)
    z_S = f_S(y)

    # L2è·ç¦»
    disc = torch.mean((z_I - z_S)**2)
    return disc
```

---

## 6. ðŸ§ª å®žéªŒä¸Žç»“æžœ

### 6.1 æ•°æ®é›†

| æ•°æ®é›† | æ¨¡æ€ | æ ·æœ¬æ•° | åˆ†å‰²ç±»åˆ« | ä»»åŠ¡ |
|--------|------|--------|----------|------|
| IBSR18 | T1-weighted | 18 | è„‘åŒº3ç±» | è„‘åŒºåˆ†å‰² |
| LPBA40 | T1-weighted | 40 | è„‘åŒº56ç±» | ç²¾ç»†è„‘åŒºåˆ†å‰² |
| ADNI | T1-weighted | å¤šä¸­å¿ƒ | æµ·é©¬ä½“ | é˜¿å°”èŒ¨æµ·é»˜ç ”ç©¶ |

### 6.2 å®žéªŒè®¾ç½®

**è®­ç»ƒå‚æ•°**ï¼š
- æ‰©æ•£æ­¥æ•°ï¼š1000ï¼ˆè®­ç»ƒï¼‰ï¼Œ50-100ï¼ˆæŽ¨ç†ï¼‰
- å™ªå£°è°ƒåº¦ï¼šçº¿æ€§
- Batch sizeï¼š8
- å­¦ä¹ çŽ‡ï¼š1e-4
- Î»ï¼ˆdiscrepancyæƒé‡ï¼‰ï¼š0.1

**è¯„ä¼°æŒ‡æ ‡**ï¼š
- Dice Scoreï¼šåˆ†å‰²é‡å åº¦
- Hausdorff Distance (HD95)ï¼šè¾¹ç•Œå‡†ç¡®æ€§
- ä½“ç§¯ç›¸ä¼¼æ€§

### 6.3 ä¸»è¦ç»“æžœ

#### 6.3.1 åˆ†å‰²ç²¾åº¦å¯¹æ¯”

| æ–¹æ³• | IBSR18 Dice | LPBA40 Dice | HD95 (mm) | æŽ¨ç†æ—¶é—´ |
|------|-------------|-------------|------------|---------|
| U-Net | 0.82 | 0.84 | 2.5 | 50ms |
| Attention U-Net | 0.84 | 0.86 | 2.2 | 80ms |
| nnU-Net | 0.87 | 0.88 | 1.8 | 100ms |
| DiffSeg | 0.86 | 0.87 | 1.9 | 5000ms |
| **DDM (æœ¬æ–‡)** | **0.88** | **0.89** | **1.6** | 3500ms |

#### 6.3.2 æ¶ˆèžå®žéªŒ

| å˜ä½“ | Dice Score | è¯´æ˜Ž |
|------|-----------|------|
| å®Œæ•´DDM | 0.88 | - |
| w/o Discrepancy | 0.85 | ç§»é™¤discrepancyæ¡ä»¶åŒ– |
| w/o Joint Training | 0.86 | ç‹¬ç«‹è®­ç»ƒä¸¤ä¸ªç½‘ç»œ |
| DDIMé‡‡æ ·(50æ­¥) | 0.87 | åŠ é€Ÿé‡‡æ · |

**å…³é”®å‘çŽ°**ï¼š
1. Discrepancyæ¡ä»¶åŒ–å¸¦æ¥çº¦3%çš„ç²¾åº¦æå‡
2. è”åˆè®­ç»ƒç­–ç•¥æœ‰æ•ˆ
3. DDIMå¯ä»¥åœ¨ä¿æŒç²¾åº¦çš„åŒæ—¶å¤§å¹…åŠ é€Ÿ

#### 6.3.3 è¾¹ç•Œç²¾åº¦åˆ†æž

**å°ç›®æ ‡ç»“æž„ï¼ˆæµ·é©¬ä½“ï¼‰**ï¼š

| æ–¹æ³• | Dice | HD95 |
|------|------|------|
| nnU-Net | 0.85 | 2.1 |
| DDM | **0.88** | **1.7** |

DDMåœ¨è¾¹ç•ŒåŒºåŸŸçš„è¡¨çŽ°æ˜Žæ˜¾æ›´å¥½ï¼Œè¿™å¯¹äºŽä¸´åºŠè¯Šæ–­éžå¸¸é‡è¦ã€‚

---

## 7. ðŸ“ˆ æŠ€æœ¯æ¼”è¿›è„‰ç»œ

```
ä¼ ç»Ÿå›¾åƒåˆ†å‰²æ–¹æ³•
    â”œâ”€â”€ é˜ˆå€¼æ³• (1960s)
    â”œâ”€â”€ åŒºåŸŸç”Ÿé•¿ (1970s)
    â””â”€â”€ æ°´å¹³é›† (1988)
        â†“
å˜åˆ†åˆ†å‰²æ–¹æ³•
    â”œâ”€â”€ Mumford-Shah (1989)
    â”œâ”€â”€ Chan-Vese (2001)
    â””â”€â”€ ROFæ¨¡åž‹ (1992)
        â†“
æ·±åº¦å­¦ä¹ åˆ†å‰²
    â”œâ”€â”€ U-Net (2015)
    â”œâ”€â”€ Attention U-Net (2017)
    â””â”€â”€ nnU-Net (2021)
        â†“
ç”Ÿæˆå¼åˆ†å‰²
    â”œâ”€â”€ SegGAN (2017)
    â”œâ”€â”€ DiffSeg (2022)
    â””â”€â”€ DDM (æœ¬æ–‡, 2024)
```

**æœ¬æ–‡å®šä½**ï¼š
- é¦–æ¬¡å°†discrepancyæ¡ä»¶åŒ–åº”ç”¨äºŽåŒ»å­¦å›¾åƒåˆ†å‰²
- æŽ¢ç´¢æ‰©æ•£æ¨¡åž‹åœ¨åŒ»å­¦é¢†åŸŸçš„è¾¹ç•Œ
- ä¸ºç”Ÿæˆå¼åˆ†å‰²æä¾›æ–°æ€è·¯

---

## 8. ðŸ”— ä¸Šä¸‹æ¸¸å…³ç³»

### 8.1 ä¸Šæ¸¸å·¥ä½œ

1. **DDPM (Ho et al., 2020)**
   - åŽ»å™ªæ‰©æ•£æ¦‚çŽ‡æ¨¡åž‹
   - æœ¬æ–‡çš„åŸºç¡€æ¡†æž¶

2. **DDIM (Song et al., 2021)**
   - ç¡®å®šæ€§é‡‡æ ·
   - æœ¬æ–‡ç”¨äºŽåŠ é€ŸæŽ¨ç†

3. **U-Net (Ronneberger et al., 2015)**
   - åŒ»å­¦å›¾åƒåˆ†å‰²ç»å…¸æž¶æž„
   - æœ¬æ–‡çš„ç¼–ç å™¨-è§£ç å™¨åŸºç¡€

### 8.2 ä¸‹æ¸¸å½±å“

1. **æ¡ä»¶åŒ–ç­–ç•¥æ”¹è¿›**
   - å…¶ä»–åŒ»å­¦å›¾åƒç”Ÿæˆä»»åŠ¡
   - å¤šæ¨¡æ€èžåˆ

2. **æ•ˆçŽ‡ä¼˜åŒ–æ–¹å‘**
   - çŸ¥è¯†è’¸é¦
   - ä¸€æ­¥ç”Ÿæˆ

3. **ä¸´åºŠåº”ç”¨**
   - è¾…åŠ©è¯Šæ–­ç³»ç»Ÿ
   - æ‰‹æœ¯è§„åˆ’å·¥å…·

---

## 9. âš™ï¸ å¯å¤çŽ°æ€§åˆ†æž

| å› ç´  | è¯„ä¼° | è¯´æ˜Ž |
|------|------|------|
| ä»£ç å¯ç”¨æ€§ | å¾…ç¡®è®¤ | arXivè®ºæ–‡ï¼Œä»£ç å¾…å‘å¸ƒ |
| æ•°æ®å¯ç”¨æ€§ | é«˜ | å…¬å¼€æ•°æ®é›† |
| å®žéªŒç»†èŠ‚ | ä¸­ | éƒ¨åˆ†è¶…å‚æ•°æœªè¯¦ç»†è¯´æ˜Ž |
| ç»“æžœå¯å¤çŽ° | ä¸­ | éšæœºæ€§å¯èƒ½å¯¼è‡´ç»“æžœæ³¢åŠ¨ |

**å¤çŽ°å»ºè®®**ï¼š
1. ä»ŽDDPMå®˜æ–¹ä»£ç å¼€å§‹
2. æ·»åŠ discrepancyè®¡ç®—æ¨¡å—
3. ä½¿ç”¨DDIMé‡‡æ ·åŠ é€Ÿ
4. åœ¨å°æ•°æ®é›†ä¸ŠéªŒè¯

---

## 10. ðŸ“š å…³é”®å‚è€ƒæ–‡çŒ®

1. Ho, J., Jain, A., & Abbeel, P. (2020). Denoising diffusion probabilistic models. *NeurIPS*.

2. Song, J., et al. (2021). Denoising diffusion implicit models. *ICLR*.

3. Ronneberger, O., et al. (2015). U-Net: Convolutional networks for biomedical image segmentation. *MICCAI*.

4. Isensee, F., et al. (2021). nnU-Net: a self-configuring method for deep learning-based biomedical image segmentation. *Nature Methods*.

---

## 11. ðŸ’» ä»£ç å®žçŽ°è¦ç‚¹

### 11.1 ä½ç½®ç¼–ç ï¼ˆæ—¶é—´æ­¥ï¼‰

```python
def get_time_embedding(t, embed_dim=128):
    """æ­£å¼¦ä½ç½®ç¼–ç """
    half_dim = embed_dim // 2
    emb = math.log(10000) / (half_dim - 1)
    emb = torch.exp(torch.arange(half_dim, device=t.device) * -emb)
    emb = t[:, None] * emb[None, :]
    emb = torch.cat([torch.sin(emb), torch.cos(emb)], dim=-1)
    return emb
```

### 11.2 Scoreç½‘ç»œï¼ˆU-Netï¼‰

```python
class ScoreUNet(nn.Module):
    def __init__(self, in_channels, time_emb_dim, cond_dim):
        super().__init__()

        # æ—¶é—´åµŒå…¥
        self.time_mlp = nn.Sequential(
            nn.Linear(time_emb_dim, time_emb_dim * 4),
            nn.SiLU(),
            nn.Linear(time_emb_dim * 4, time_emb_dim)
        )

        # U-Netç»“æž„
        self.down1 = DownBlock(in_channels, 64, cond_dim)
        self.down2 = DownBlock(64, 128, cond_dim)
        self.down3 = DownBlock(128, 256, cond_dim)

        self.up1 = UpBlock(256, 128, cond_dim)
        self.up2 = UpBlock(128, 64, cond_dim)
        self.up3 = UpBlock(64, in_channels, cond_dim)

    def forward(self, x, t, cond):
        # æ—¶é—´åµŒå…¥
        t_emb = self.time_mlp(t)

        # ä¸‹é‡‡æ ·
        d1 = self.down1(x, t_emb, cond)
        d2 = self.down2(d1, t_emb, cond)
        d3 = self.down3(d2, t_emb, cond)

        # ä¸Šé‡‡æ ·
        u1 = self.up1(d3, t_emb, cond)
        u2 = self.up2(u1, t_emb, cond)
        u3 = self.up3(u2, t_emb, cond)

        return u3
```

### 11.3 è°ƒè¯•éªŒè¯

```python
# éªŒè¯æ‰©æ•£é‡‡æ ·
assert y_t.shape == y.shape, "å½¢çŠ¶åº”ä¿æŒä¸€è‡´"
assert y_t.min() >= -3 and y_t.max() <= 3, "é‡‡æ ·å€¼èŒƒå›´å¼‚å¸¸"

# éªŒè¯discrepancy
assert disc.item() >= 0, "Discrepancyåº”ä¸ºéžè´Ÿ"

# éªŒè¯åˆ†å‰²è¾“å‡º
assert y_pred.shape == (B, C, H, W), "è¾“å‡ºå½¢çŠ¶é”™è¯¯"
assert torch.all(y_pred >= 0) and torch.all(y_pred <= 1), "è¾“å‡ºåº”åœ¨[0,1]"
```

---

## 12. ðŸŒŸ åº”ç”¨ä¸Žå½±å“

### 12.1 åº”ç”¨åœºæ™¯

1. **è„‘ç–¾ç—…è¯Šæ–­**
   - é˜¿å°”èŒ¨æµ·é»˜ç—…ï¼šæµ·é©¬ä½“èŽç¼©æµ‹é‡
   - è„‘è‚¿ç˜¤ï¼šè‚¿ç˜¤ä½“ç§¯ç²¾ç¡®åˆ†å‰²
   - å¤šå‘æ€§ç¡¬åŒ–ï¼šç—…ç¶æ£€æµ‹

2. **æ‰‹æœ¯è§„åˆ’**
   - æœ¯å‰ç²¾ç¡®æµ‹é‡
   - æ‰‹æœ¯è·¯å¾„è§„åˆ’
   - é£Žé™©è¯„ä¼°

3. **ç¥žç»ç§‘å­¦ç ”ç©¶**
   - è„‘åŒºå½¢æ€åˆ†æž
   - çº¤ç»´æŸè¿½è¸ªè¾…åŠ©
   - åŠŸèƒ½è¿žæŽ¥åˆ†æž

### 12.2 æŠ€æœ¯ä»·å€¼

| ä¼˜åŠ¿ | è¯´æ˜Ž |
|------|------|
| è¾¹ç•Œç²¾ç»† | å°ç›®æ ‡åˆ†å‰²æ›´å‡†ç¡® |
| ä¸ç¡®å®šæ€§ä¼°è®¡ | æ‰©æ•£è¿‡ç¨‹æä¾›ç½®ä¿¡åº¦ |
| ç”Ÿæˆèƒ½åŠ› | å¯äº§ç”Ÿå¤šç§å¯èƒ½åˆ†å‰² |

---

## 13. â“ æœªè§£é—®é¢˜ä¸Žå±•æœ›

### 13.1 å±€é™æ€§

1. **è®¡ç®—æ•ˆçŽ‡**
   - æŽ¨ç†æ—¶é—´3-5ç§’
   - æ— æ³•æ»¡è¶³å®žæ—¶åº”ç”¨éœ€æ±‚

2. **æ•°æ®éœ€æ±‚**
   - éœ€è¦å¤§é‡è®­ç»ƒæ•°æ®
   - åŒ»å­¦æ•°æ®èŽ·å–å›°éš¾

3. **å†…å­˜å ç”¨**
   - 6-8GB GPUå†…å­˜
   - é™åˆ¶äº†æ¨¡åž‹è§„æ¨¡

### 13.2 æœªæ¥æ–¹å‘

1. **æ•ˆçŽ‡ä¼˜åŒ–**
   - çŸ¥è¯†è’¸é¦åˆ°è½»é‡ç½‘ç»œ
   - æ›´å°‘çš„é‡‡æ ·æ­¥æ•°
   - æ¨¡åž‹åŽ‹ç¼©

2. **å°‘æ ·æœ¬å­¦ä¹ **
   - å…ƒå­¦ä¹ æ¡†æž¶
   - è¿ç§»å­¦ä¹ 
   - æ•°æ®å¢žå¼º

3. **å¤šæ¨¡æ€èžåˆ**
   - T1 + T2 + FLAIR
   - è·¨æ¨¡æ€é¢„è®­ç»ƒ
   - æ³¨æ„åŠ›èžåˆæœºåˆ¶

---

## ðŸŽ¯ ç»¼åˆè¯„åˆ†

| ç»´åº¦ | è¯„åˆ† | è¯´æ˜Ž |
|------|------|------|
| ç†è®ºæ·±åº¦ | â˜…â˜…â˜…â˜†â˜† | æ‰©æ•£ç†è®ºåº”ç”¨ï¼Œæ–°æ„æœ‰é™ |
| æ–¹æ³•åˆ›æ–° | â˜…â˜…â˜…â˜…â˜† | Discrepancyæ¡ä»¶åŒ–æœ‰æ–°æ„ |
| å®žçŽ°éš¾åº¦ | â˜…â˜…â˜…â˜…â˜† | å¤æ‚åº¦é«˜ï¼Œå®žçŽ°å›°éš¾ |
| åº”ç”¨ä»·å€¼ | â˜…â˜…â˜…â˜†â˜† | åŒ»å­¦åº”ç”¨é‡è¦ï¼Œä½†æ•ˆçŽ‡é—®é¢˜ |
| è®ºæ–‡è´¨é‡ | â˜…â˜…â˜…â˜…â˜† | å®žéªŒå……åˆ†ï¼Œå†™ä½œæ¸…æ™° |

**æ€»åˆ†ï¼šâ˜…â˜…â˜…â˜…â˜† (3.8/5.0)**

---

## ðŸ“ åˆ†æžç¬”è®°

```
ä¸ªäººç†è§£:

1. æ‰©æ•£æ¨¡åž‹åœ¨åŒ»å­¦å›¾åƒä¸­çš„æ ¸å¿ƒæŒ‘æˆ˜ï¼š
   - ä¸æ˜¯ç”Ÿæˆè´¨é‡ï¼Œè€Œæ˜¯è®¡ç®—æ•ˆçŽ‡
   - DDMé€šè¿‡discrepancyæ¡ä»¶åŒ–æä¾›äº†æ–°æ€è·¯

2. Discrepancyæ¡ä»¶åŒ–çš„ä¼˜åŠ¿ï¼š
   - ç›´è§‚ï¼šç›¸ä¼¼å›¾åƒåº”æœ‰ç›¸ä¼¼åˆ†å‰²
   - é«˜æ•ˆï¼šç‰¹å¾ç©ºé—´è®¡ç®—ç®€å•
   - çµæ´»ï¼šå¯è°ƒèŠ‚æ¡ä»¶åŒ–å¼ºåº¦

3. å®žé™…åº”ç”¨çš„è€ƒè™‘ï¼š
   - ç§‘ç ”åœºæ™¯ï¼šå¯æŽ¥å—ï¼ˆä¸è¿½æ±‚å®žæ—¶ï¼‰
   - ä¸´åºŠåœºæ™¯ï¼šéœ€è¦ä¼˜åŒ–ï¼ˆåŠ é€Ÿ10-100å€ï¼‰
   - æ··åˆç­–ç•¥ï¼šç²—åˆ†å‰²ç”¨å¿«é€Ÿæ–¹æ³•ï¼Œç»†åˆ†å‰²ç”¨DDM

4. ä¸ŽGANå¯¹æ¯”ï¼š
   - è®­ç»ƒæ›´ç¨³å®š
   - å¯æä¾›ä¸ç¡®å®šæ€§
   - ä½†è®¡ç®—å¼€é”€æ›´å¤§

5. æœªæ¥æœ€æœ‰ä»·å€¼çš„æ–¹å‘ï¼š
   - çŸ¥è¯†è’¸é¦ï¼šä¿æŒDDMè´¨é‡ï¼Œè¾¾åˆ°U-Neté€Ÿåº¦
   - æ··åˆæž¶æž„ï¼šå¹³è¡¡é€Ÿåº¦ä¸Žç²¾åº¦
```

---

*æœ¬ç¬”è®°ç”±5-Agentè¾©è®ºåˆ†æžç³»ç»Ÿç”Ÿæˆï¼Œç»“åˆå¤šæ™ºèƒ½ä½“ç²¾è¯»æŠ¥å‘Šè¿›è¡Œæ·±å…¥åˆ†æžã€‚*
