# Tight-Frame Vessel Segmentation

> **è¶…ç²¾è¯»ç¬”è®°** | 5-Agentè¾©è®ºåˆ†æç³»ç»Ÿ
> åˆ†ææ—¶é—´ï¼š2026-02-16
> æ¥æºï¼šIEEE TMI 2011

---

## ğŸ“„ è®ºæ–‡å…ƒä¿¡æ¯

| å±æ€§ | ä¿¡æ¯ |
|------|------|
| **æ ‡é¢˜** | Retinal Vessel Segmentation Using Tight Frame and Multi-scale Analysis |
| **ä½œè€…** | Xiaohao Cai, Raymond Chan, Lixin Shen, Andrea L. Bertozzi |
| **å¹´ä»½** | 2011 |
| **æœŸåˆŠ** | IEEE Transactions on Medical Imaging (é¢„å°æœ¬ arXiv:1109.0217) |
| **å…³é”®è¯** | è§†ç½‘è†œè¡€ç®¡åˆ†å‰²ã€Tight Frameã€å¤šå°ºåº¦åˆ†æã€å°æ³¢æ¡†æ¶ã€åŒ»å­¦å½±åƒ |

### ğŸ“ æ‘˜è¦ç¿»è¯‘

æœ¬æ–‡æå‡ºäº†ä¸€ç§åŸºäºç´§å°æ³¢æ¡†æ¶ï¼ˆTight Frameï¼‰å’Œå¤šå°ºåº¦åˆ†æçš„è§†ç½‘è†œè¡€ç®¡åˆ†å‰²æ–¹æ³•ã€‚è§†ç½‘è†œè¡€ç®¡åˆ†å‰²æ˜¯ç³–å°¿ç—…è§†ç½‘è†œç—…å˜æ—©æœŸè¯Šæ–­çš„å…³é”®æ­¥éª¤ï¼Œä½†é¢ä¸´ä½å¯¹æ¯”åº¦ã€å®½åº¦å˜åŒ–å¤§ã€ç»“æ„å¤æ‚ç­‰æŒ‘æˆ˜ã€‚æˆ‘ä»¬å¼•å…¥ç´§æ¡†æ¶å˜æ¢æä¾›å›¾åƒçš„å†—ä½™å¤šå°ºåº¦è¡¨ç¤ºï¼Œé€šè¿‡è‡ªé€‚åº”é˜ˆå€¼å»é™¤å™ªå£°åŒæ—¶ä¿ç•™è¡€ç®¡ç»†èŠ‚ã€‚ç»“åˆHessiançŸ©é˜µçš„å¤šå°ºåº¦è¡€ç®¡æ£€æµ‹ï¼Œå®ç°äº†å¯¹å®½åº¦å’Œå¯¹æ¯”åº¦å˜åŒ–è¡€ç®¡çš„é²æ£’åˆ†å‰²ã€‚åœ¨DRIVEå’ŒSTAREæ•°æ®é›†ä¸Šçš„å®éªŒè¡¨æ˜ï¼Œè¯¥æ–¹æ³•è¾¾åˆ°äº†å½“æ—¶çš„æœ€ä½³æ€§èƒ½ã€‚

---

## ğŸ”¢ 1. æ•°å­¦å®¶Agentï¼šç†è®ºåˆ†æ

### 1.1 æ ¸å¿ƒæ•°å­¦æ¡†æ¶

**å°æ³¢æ¡†æ¶ç†è®º**

æœ¬æ–‡ä¸»è¦ä½¿ç”¨çš„æ•°å­¦å·¥å…·ï¼š
- **å°æ³¢åˆ†æ**ï¼šå¤šå°ºåº¦æ—¶é¢‘è¡¨ç¤º
- **æ¡†æ¶ç†è®º**ï¼šç´§æ¡†æ¶ï¼ˆTight Frameï¼‰çš„æ„é€ ä¸æ€§è´¨
- **å˜åˆ†æ³•**ï¼š Mumford-Shahå‹åˆ†å‰²æ¨¡å‹
- **å¾®åˆ†å‡ ä½•**ï¼šHessiançŸ©é˜µã€ç‰¹å¾å€¼åˆ†æ

**å…³é”®æ•°å­¦å®šä¹‰ï¼š**

**1. æ¡†æ¶ï¼ˆFrameï¼‰å®šä¹‰**

```
{Ïˆ_j} æ˜¯ Hilbert ç©ºé—´ H çš„æ¡†æ¶ï¼Œå½“ä¸”ä»…å½“å­˜åœ¨ 0 < A â‰¤ B < âˆ ä½¿å¾—ï¼š
AÂ·||f||Â² â‰¤ âˆ‘_j |âŸ¨f, Ïˆ_jâŸ©|Â² â‰¤ BÂ·||f||Â²,  âˆ€f âˆˆ H

å½“ A = B = 1 æ—¶ï¼Œç§°ä¸ºç´§æ¡†æ¶ï¼ˆTight Frameï¼‰
```

**ç´§æ¡†æ¶æ€§è´¨**ï¼š
- å®Œç¾é‡æ„ï¼šf = âˆ‘_j âŸ¨f, Ïˆ_jâŸ© Ïˆ_j
- å†—ä½™è¡¨ç¤ºï¼šæ¡†æ¶å‡½æ•°å¤šäºåŸºå‡½æ•°
- é²æ£’æ€§ï¼šå¯¹å™ªå£°å’Œç¼ºå¤±æ•°æ®æ›´ç¨³å¥

**2. Bæ ·æ¡ç´§æ¡†æ¶æ„é€ **

åŸºäºé…‰æ‰©å±•åŸç†ï¼ˆUEPï¼‰ï¼Œè®¾å°ºåº¦å‡½æ•°ä¸ºÏ†ï¼š

```
Ïˆ^{(0)}(Î¾) = Ã¢(Î¾/2)Ï†Ì‚(Î¾/2)
Ïˆ^{(l)}(Î¾) = Ã¢^{(l)}(Î¾/2)Ï†Ì‚(Î¾/2), l = 1,...,r
```

å…¶ä¸­æ»¤æ³¢å™¨{Ã¢, Ã¢^{(l)}}æ»¡è¶³ï¼š
```
|Ã¢(Î¾)|Â² + âˆ‘_{l=1}^r |Ã¢^{(l)}(Î¾)|Â² = 1
|Ã¢(Î¾+Ï€)|Â² + âˆ‘_{l=1}^r |Ã¢^{(l)}(Î¾+Ï€)|Â² = 1
```

**3. æ¡†æ¶åŸŸMumford-Shahæ¨¡å‹**

```
E(Î±, Î“) = (Î»/2)||W^TÎ± - f||Â²â‚‚ + ||Î±||â‚ + Î¼Â·Length(Î“)
```

å…¶ä¸­ï¼š
- Wï¼šæ¡†æ¶åˆ†æç®—å­
- Î±ï¼šæ¡†æ¶ç³»æ•°
- W^TÎ±ï¼šé‡æ„å›¾åƒ
- ||Î±||â‚ï¼šç¨€ç–æ­£åˆ™ï¼ˆâ„“â‚èŒƒæ•°ï¼‰
- Î“ï¼šåˆ†å‰²è¾¹ç•Œ

### 1.2 å…³é”®å…¬å¼æ¨å¯¼

**æ ¸å¿ƒå…¬å¼1ï¼šè½¯é˜ˆå€¼ç®—å­**

â„“â‚æ­£åˆ™çš„è¿‘ç«¯ç®—å­ï¼š

```
prox_{Î»||Â·||â‚}(x) = sign(x)Â·max(|x| - Î», 0)
```

**æ¨å¯¼**ï¼šæ±‚è§£ min_y Â½||y-x||Â² + Î»||y||â‚

æ¬¡æ¡ä»¶ï¼š0 âˆˆ y - x + Î»Â·âˆ‚||y||â‚

è§£å¾—ï¼šy_i = sign(x_i)Â·max(|x_i| - Î», 0)

**æ ¸å¿ƒå…¬å¼2ï¼šå¤šå°ºåº¦Hessianè¡€ç®¡æ£€æµ‹**

å¯¹äºå›¾åƒIï¼Œå°ºåº¦Ïƒä¸‹çš„HessiançŸ©é˜µï¼š

```
H_Ïƒ = [I_xx(Ïƒ)  I_xy(Ïƒ)]
       [I_xy(Ïƒ)  I_yy(Ïƒ)]
```

ç‰¹å¾å€¼ï¼š|Î»â‚| â‰¤ |Î»â‚‚|

**Frangiè¡€ç®¡åº¦å“åº”**ï¼š

```
V(Ïƒ) = {0                                    if Î»â‚‚ > 0
       {exp(-RBÂ²/(2Î²Â²)) Â· (1-exp(-SÂ²/(2cÂ²)))  otherwise
```

å…¶ä¸­ï¼š
- RB = |Î»â‚|/|Î»â‚‚|ï¼šå„å‘å¼‚æ€§æ¯”ï¼ˆè¡€ç®¡åº”è¯¥RBâ†’0ï¼‰
- SÂ² = Î»â‚Â² + Î»â‚‚Â²ï¼šHessianæ¨¡é•¿

**æ ¸å¿ƒå…¬å¼3ï¼šè‡ªé€‚åº”æ¡†æ¶é˜ˆå€¼**

æ¯å±‚jçš„é˜ˆå€¼ï¼š

```
Î»_j = Î»â‚€ Â· 2^j
```

**åŸå› **ï¼š
- ç»†å°ºåº¦ï¼ˆå¤§jï¼‰ï¼šå™ªå£°å¤§ï¼Œå¤§é˜ˆå€¼
- ç²—å°ºåº¦ï¼ˆå°jï¼‰ï¼šä¿¡å·ä¸»å¯¼ï¼Œå°é˜ˆå€¼

### 1.3 ç†è®ºæ€§è´¨åˆ†æ

**æ”¶æ•›æ€§åˆ†æï¼š**
- è½¯é˜ˆå€¼è¿­ä»£ï¼šå›ºå®šç‚¹æ”¶æ•›
- Split Bregmanç®—æ³•ï¼šçº¿æ€§æ”¶æ•›

**æ¡†æ¶æ€§è´¨ï¼š**
- å†—ä½™åº¦ï¼šr+1ï¼ˆrä¸ªé«˜é€š+1ä¸ªä½é€šï¼‰
- æ¶ˆå¤±çŸ©ï¼špé˜¶ï¼ˆBæ ·æ¡é˜¶æ•°å†³å®šï¼‰

**å¤æ‚åº¦ç•Œï¼š**
- Jå±‚æ¡†æ¶åˆ†è§£ï¼šO(NÂ·rÂ·J)
- é‡æ„ï¼šO(NÂ·rÂ·J)
- æ€»å¤æ‚åº¦ï¼šO(NÂ·rÂ·J)

### 1.4 æ•°å­¦åˆ›æ–°ç‚¹

**æ–°çš„æ•°å­¦å·¥å…·ï¼š**
1. **æ¡†æ¶åŸŸåˆ†å‰²**ï¼šé¦–æ¬¡åœ¨æ¡†æ¶åŸŸè¿›è¡Œè¡€ç®¡åˆ†å‰²
2. **è‡ªé€‚åº”å¤šå°ºåº¦é˜ˆå€¼**ï¼šå°ºåº¦ä¾èµ–çš„é˜ˆå€¼ç­–ç•¥
3. **Hessian-æ¡†æ¶èåˆ**ï¼šå‡ ä½•ä¿¡æ¯ä¸æ¡†æ¶è¡¨ç¤ºç»“åˆ

**ç†è®ºæ”¹è¿›ï¼š**
1. æ¯”ä¼ ç»Ÿå°æ³¢æ›´é²æ£’ï¼ˆç´§æ¡†æ¶å†—ä½™æ€§ï¼‰
2. æ¯”å•ä¸€å°ºåº¦æ›´å…¨é¢ï¼ˆå¤šå°ºåº¦åˆ†æï¼‰
3. æ¯”çº¯é˜ˆå€¼æ›´å‡†ç¡®ï¼ˆHessianå…ˆéªŒï¼‰

---

## ğŸ”§ 2. å·¥ç¨‹å¸ˆAgentï¼šå®ç°åˆ†æ

### 2.1 ç®—æ³•æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Tight Frame è§†ç½‘è†œè¡€ç®¡åˆ†å‰²ç³»ç»Ÿ                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  è¾“å…¥: è§†ç½‘è†œå›¾åƒ f (RGB â†’ ç»¿é€šé“)                               â”‚
â”‚                         â†“                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  é¢„å¤„ç†                                                   â”‚   â”‚
â”‚  â”‚  - æå–ç»¿è‰²é€šé“ (è¡€ç®¡å¯¹æ¯”åº¦æœ€é«˜)                          â”‚   â”‚
â”‚  â”‚  - å¯¹æ¯”åº¦å—é™è‡ªé€‚åº”ç›´æ–¹å›¾å‡è¡¡ (CLAHE)                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â†“                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Jå±‚ç´§æ¡†æ¶åˆ†è§£                                           â”‚   â”‚
â”‚  â”‚  for j = 0 to J-1:                                      â”‚   â”‚
â”‚  â”‚    ä½é¢‘: c_{j+1} = â†“(a^{(0)} * c_j)                     â”‚   â”‚
â”‚  â”‚    é«˜é¢‘: d_j^{(l)} = â†“(a^{(l)} * c_j), l=1,...,r       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â†“                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  è‡ªé€‚åº”é˜ˆå€¼å¤„ç†                                           â”‚   â”‚
â”‚  â”‚  for each level j and band l:                           â”‚   â”‚
â”‚  â”‚    d_j^{(l)} = SoftThreshold(d_j^{(l)}, Î»_j)            â”‚   â”‚
â”‚  â”‚    å…¶ä¸­ Î»_j = Î»_0 Â· 2^j                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â†“                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  æ¡†æ¶é‡æ„                                                 â”‚   â”‚
â”‚  â”‚  f_denoised = FrameReconstruct({c_J, {d_j}})             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â†“                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  å¤šå°ºåº¦Hessianè¡€ç®¡æ£€æµ‹                                     â”‚   â”‚
â”‚  â”‚  for each scale Ïƒ in [Ïƒâ‚, Ïƒâ‚‚, ..., Ïƒ_m]:                â”‚   â”‚
â”‚  â”‚    H = Hessian(G_Ïƒ * f_denoised)                         â”‚   â”‚
â”‚  â”‚    V_Ïƒ = FrangiVesselness(H, Ïƒ)                          â”‚   â”‚
â”‚  â”‚  ç´¯ç§¯å“åº”: V = max(V, V_Ïƒ)                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â†“                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  åå¤„ç†                                                   â”‚   â”‚
â”‚  â”‚  - è‡ªé€‚åº”é˜ˆå€¼                                           â”‚   â”‚
â”‚  â”‚  - å½¢æ€å­¦å»å™ª                                           â”‚   â”‚
â”‚  â”‚  - è¿æ¥æ€§åˆ†æ                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â†“                                        â”‚
â”‚  è¾“å‡º: è¡€ç®¡åˆ†å‰²äºŒå€¼å›¾                                           â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 å…³é”®å®ç°è¦ç‚¹

**æ•°æ®ç»“æ„è®¾è®¡ï¼š**

```python
import numpy as np
from scipy.ndimage import gaussian_filter, gaussian_laplace
from scipy import ndimage

class TightFrameVesselSegmentation:
    def __init__(self, J=4, lambda_0=0.1, scales=[1, 2, 4, 8]):
        """
        å‚æ•°:
            J: æ¡†æ¶åˆ†è§£å±‚æ•°
            lambda_0: åŸºç¡€é˜ˆå€¼å‚æ•°
            scales: Hessianæ£€æµ‹å°ºåº¦åˆ—è¡¨
        """
        self.J = J
        self.lambda_0 = lambda_0
        self.scales = scales

        # Bæ ·æ¡ç´§æ¡†æ¶æ»¤æ³¢å™¨ (ç®€åŒ–ç‰ˆ)
        self.filters = self._construct_bspline_filters()

    def _construct_bspline_filters(self):
        """æ„é€ Bæ ·æ¡ç´§æ¡†æ¶æ»¤æ³¢å™¨"""
        # ç®€åŒ–ï¼šä½¿ç”¨å¸¸ç”¨çš„å°æ³¢æ»¤æ³¢å™¨
        # ä½é€š: [1/4, 1/2, 1/4] / sqrt(2)
        # é«˜é€š: [-1/4, 1/2, -1/4] / sqrt(2)
        import pywt
        wavelet = pywt.Wavelet('bior2.2')
        return wavelet.filter_bank

    def frame_decomposition(self, image):
        """Jå±‚ç´§æ¡†æ¶åˆ†è§£"""
        coeffs = []
        c = image.astype(float).copy()

        for j in range(self.J):
            # åˆ†è§£
            c_low = ndimage.convolve1d(c, self.filters[0][0], axis=0, mode='mirror')
            c_low = ndimage.convolve1d(c_low, self.filters[0][0], axis=1, mode='mirror')
            c_low = c_low[::2, ::2]  # ä¸‹é‡‡æ ·

            # é«˜é¢‘ (ç®€åŒ–ï¼šåªå¤„ç†ä¸€ä¸ªæ–¹å‘)
            c_high = ndimage.convolve1d(c, self.filters[0][1], axis=0, mode='mirror')
            c_high = ndimage.convolve1d(c_high, self.filters[0][1], axis=1, mode='mirror')
            c_high = c_high[::2, ::2]

            coeffs.append(c_high)
            c = c_low

        coeffs.append(c)  # æœ€ä½é¢‘
        return coeffs

    def frame_reconstruction(self, coeffs):
        """æ¡†æ¶é‡æ„"""
        c = coeffs[-1]

        for j in reversed(range(self.J)):
            # ä¸Šé‡‡æ ·
            c_up = np.zeros((c.shape[0]*2, c.shape[1]*2))
            c_up[::2, ::2] = c

            # é«˜é¢‘ä¸Šé‡‡æ ·
            d = coeffs[j]
            d_up = np.zeros((d.shape[0]*2, d.shape[1]*2))
            d_up[::2, ::2] = d

            # é‡æ„ (ç®€åŒ–ç‰ˆ)
            c = ndimage.convolve1d(c_up, self.filters[1][0], axis=0, mode='mirror')
            c = ndimage.convolve1d(c, self.filters[1][0], axis=1, mode='mirror')
            c = c + ndimage.convolve1d(d_up, self.filters[1][1], axis=0, mode='mirror')
            c = ndimage.convolve1d(c, self.filters[1][1], axis=1, mode='mirror')

        return c

    def soft_threshold(self, coeffs, lambda_param):
        """è½¯é˜ˆå€¼å‡½æ•°"""
        return np.sign(coeffs) * np.maximum(np.abs(coeffs) - lambda_param, 0)

    def adaptive_threshold(self, coeffs):
        """è‡ªé€‚åº”é˜ˆå€¼å¤„ç†"""
        denoised_coeffs = []
        for j, level_coeffs in enumerate(coeffs[:-1]):
            lambda_j = self.lambda_0 * (2 ** j)
            denoised = self.soft_threshold(level_coeffs, lambda_j)
            denoised_coeffs.append(denoised)
        denoised_coeffs.append(coeffs[-1])  # æœ€ä½é¢‘ä¸é˜ˆå€¼
        return denoised_coeffs

    def compute_hessian(self, image, sigma):
        """è®¡ç®—HessiançŸ©é˜µ"""
        # äºŒé˜¶å¯¼æ•°
        Ixx = gaussian_filter(image, sigma, order=[0, 2])
        Iyy = gaussian_filter(image, sigma, order=[2, 0])
        Ixy = gaussian_filter(image, sigma, order=[1, 1])
        return Ixx, Ixy, Iyy

    def frangi_vesselness(self, Ixx, Ixy, Iyy, sigma):
        """Frangiè¡€ç®¡åº¦å“åº”"""
        # ç‰¹å¾å€¼
        tmp = np.sqrt((Ixx - Iyy)**2 + 4*Ixy**2)
        lambda1 = (Ixx + Iyy - tmp) / 2
        lambda2 = (Ixx + Iyy + tmp) / 2

        # æ’åº: |lambda1| <= |lambda2|
        abs_lambda1 = np.abs(lambda1)
        abs_lambda2 = np.abs(lambda2)

        # å„å‘å¼‚æ€§
        RB = np.ones_like(lambda1)
        mask = abs_lambda2 > 1e-10
        RB[mask] = abs_lambda1[mask] / abs_lambda2[mask]

        # ç»“æ„å¼ é‡èƒ½é‡
        S2 = lambda1**2 + lambda2**2

        # Frangiå“åº”
        beta = 0.5
        c = 15.0  # å‚æ•°

        vesselness = np.zeros_like(lambda1)
        mask2 = lambda2 < 0  # æš—èƒŒæ™¯äº®è¡€ç®¡

        vesselness[mask2] = (
            np.exp(-RB[mask2]**2 / (2*beta**2)) *
            (1 - np.exp(-S2[mask2] / (2*c**2)))
        )

        return vesselness * (1 - np.exp(-sigma**2 / 20))  # å°ºåº¦æƒé‡

    def multiscale_vesselness(self, image):
        """å¤šå°ºåº¦è¡€ç®¡åº¦"""
        H, W = image.shape
        vesselness = np.zeros((H, W))

        for sigma in self.scales:
            Ixx, Ixy, Iyy = self.compute_hessian(image, sigma)
            v = self.frangi_vesselness(Ixx, Ixy, Iyy, sigma)
            vesselness = np.maximum(vesselness, v)

        return vesselness

    def segment(self, image):
        """å®Œæ•´åˆ†å‰²æµç¨‹"""
        # 1. é¢„å¤„ç†ï¼šæå–ç»¿è‰²é€šé“
        if image.ndim == 3:
            gray = image[:, :, 1]  # ç»¿é€šé“
        else:
            gray = image.copy()

        # 2. æ¡†æ¶åˆ†è§£ä¸é˜ˆå€¼å»å™ª
        coeffs = self.frame_decomposition(gray)
        denoised_coeffs = self.adaptive_threshold(coeffs)
        denoised = self.frame_reconstruction(denoised_coeffs)

        # å½’ä¸€åŒ–
        denoised = (denoised - denoised.min()) / (denoised.max() - denoised.min())

        # 3. å¤šå°ºåº¦Hessianè¡€ç®¡æ£€æµ‹
        vesselness = self.multiscale_vesselness(denoised)

        # 4. åå¤„ç†
        # è‡ªé€‚åº”é˜ˆå€¼
        thresh = vesselness.mean() + 0.5 * vesselness.std()
        segmentation = vesselness > thresh

        # å½¢æ€å­¦å¤„ç†
        from skimage.morphology import remove_small_objects, binary_dilation
        segmentation = remove_small_objects(segmentation, min_size=50)
        segmentation = binary_dilation(segmentation, np.ones((2,2)))

        return segmentation, vesselness, denoised
```

**ç®—æ³•ä¼ªä»£ç ï¼š**

```
ALGORITHM Tight Frame è§†ç½‘è†œè¡€ç®¡åˆ†å‰²
INPUT: è§†ç½‘è†œRGBå›¾åƒ f, åˆ†è§£å±‚æ•° J, æ£€æµ‹å°ºåº¦ scales
OUTPUT: è¡€ç®¡åˆ†å‰² binary_map

1. é¢„å¤„ç†:
   green = f(:, :, 2)  // æå–ç»¿è‰²é€šé“
   green = CLAHE(green)  // å¯¹æ¯”åº¦å¢å¼º

2. Jå±‚ç´§æ¡†æ¶åˆ†è§£:
   coeffs = []
   c = green
   for j = 1 to J:
       c_low = â†“(lowpass * c)
       c_high = â†“(highpass * c)
       coeffs.append(c_high)
       c = c_low
   end for
   coeffs.append(c)  // æœ€ä½é¢‘

3. è‡ªé€‚åº”é˜ˆå€¼:
   for j = 0 to J-1:
       Î»_j = Î»_0 Â· 2^j
       coeffs[j] = sign(coeffs[j]) Â· max(|coeffs[j]| - Î»_j, 0)
   end for

4. æ¡†æ¶é‡æ„:
   f_denoised = FrameReconstruct(coeffs)

5. å¤šå°ºåº¦Hessianæ£€æµ‹:
   V = zeros(f_denoised.shape)
   for each Ïƒ in scales:
       H = Hessian(G_Ïƒ * f_denoised)
       V_Ïƒ = FrangiVesselness(H, Ïƒ)
       V = max(V, V_Ïƒ)
   end for

6. åå¤„ç†:
   thresh = mean(V) + 0.5Â·std(V)
   binary = V > thresh
   binary = RemoveSmallObjects(binary, 50)
   binary = BinaryDilation(binary)

7. RETURN binary
```

### 2.3 è®¡ç®—å¤æ‚åº¦

| é¡¹ç›® | å¤æ‚åº¦ | è¯´æ˜ |
|------|--------|------|
| æ¡†æ¶åˆ†è§£ | O(NÂ·J) | Nåƒç´ ï¼ŒJå±‚ |
| æ¡†æ¶é‡æ„ | O(NÂ·J) | Jå±‚é‡æ„ |
| é˜ˆå€¼å¤„ç† | O(NÂ·J) | æ¯å±‚é˜ˆå€¼ |
| Hessianè®¡ç®— | O(NÂ·|scales|) | æ¯ä¸ªå°ºåº¦ |
| **æ€»å¤æ‚åº¦** | **O(NÂ·(J + |scales|))** | çº¿æ€§å¤æ‚åº¦ |

### 2.4 å®ç°å»ºè®®

**æ¨èç¼–ç¨‹è¯­è¨€/æ¡†æ¶ï¼š**
- Python + PyWavelets + SciPy (æ¨è)
- MATLAB + Wavelet Toolbox
- C++ + ITK (åŒ»å­¦å›¾åƒåº“)

**å…³é”®ä»£ç ç‰‡æ®µï¼š**

```python
import numpy as np
import pywt
from skimage import color, filters, morphology
from scipy.ndimage import gaussian_filter

def tight_frame_vessel_segmentation(image, J=4, scales=[1, 2, 4, 8]):
    """Tight Frameè¡€ç®¡åˆ†å‰²"""

    # 1. æå–ç»¿è‰²é€šé“
    if image.ndim == 3:
        gray = image[:, :, 1]
    else:
        gray = image

    # 2. CLAHEå¯¹æ¯”åº¦å¢å¼º
    from skimage import exposure
    gray = exposure.equalize_adapthist(gray)

    # 3. å°æ³¢æ¡†æ¶åˆ†è§£ä¸é˜ˆå€¼
    coeffs = pywt.wavedec2(gray, 'bior2.2', level=J)

    # è‡ªé€‚åº”é˜ˆå€¼
    lambda_0 = 0.1
    denoised_coeffs = []
    for j, coeff in enumerate(coeffs[:-1]):
        lambda_j = lambda_0 * (2 ** j)
        denoised = pywt.threshold(coeff, lambda_j, mode='soft')
        denoised_coeffs.append(denoised)
    denoised_coeffs.append(coeffs[-1])  # è¿‘ä¼¼ç³»æ•°ä¸é˜ˆå€¼

    # é‡æ„
    denoised = pywt.waverec2(denoised_coeffs, 'bior2.2')

    # å½’ä¸€åŒ–
    denoised = (denoised - denoised.min()) / (denoised.max() - denoised.min())

    # 4. å¤šå°ºåº¦Frangiè¡€ç®¡æ£€æµ‹
    from skimage.filters import frangi
    vesselness = frangi(denoised, scales=scales, beta=0.5, c=15)

    # 5. åå¤„ç†
    thresh = filters.threshold_otsu(vesselness)
    binary = vesselness > thresh

    # å½¢æ€å­¦æ¸…ç†
    binary = morphology.remove_small_objects(binary, min_size=100)
    binary = morphology.binary_closing(binary, morphology.disk(2))

    return binary, vesselness, denoised

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    # æ¨¡æ‹Ÿè§†ç½‘è†œå›¾åƒ (å®é™…åº”ä½¿ç”¨DRIVE/STAREæ•°æ®é›†)
    H, W = 512, 512
    image = np.random.rand(H, W, 3)

    segmentation, vesselness, denoised = tight_frame_vessel_segmentation(image)

    print(f"åˆ†å‰²ç»“æœ: {segmentation.shape}")
    print(f"è¡€ç®¡åƒç´ æ¯”ä¾‹: {np.mean(segmentation):.2%}")
```

---

## ğŸ’¼ 3. åº”ç”¨ä¸“å®¶Agentï¼šä»·å€¼åˆ†æ

### 3.1 åº”ç”¨åœºæ™¯

**æ ¸å¿ƒé¢†åŸŸï¼š**
- [âœ“] åŒ»å­¦å½±åƒ
- [âœ“] çœ¼ç§‘è¯Šæ–­
- [âœ“] ç–¾ç—…ç­›æŸ¥

**å…·ä½“åº”ç”¨åœºæ™¯ï¼š**

1. **ç³–å°¿ç—…è§†ç½‘è†œç—…å˜ç­›æŸ¥**
   - åœºæ™¯ï¼šå¤§è§„æ¨¡äººç¾¤ç­›æŸ¥
   - æŒ‘æˆ˜ï¼šéœ€è¦è‡ªåŠ¨åŒ–ã€é«˜å‡†ç¡®ç‡
   - Tight-Frameä¼˜åŠ¿ï¼šé²æ£’ã€å‡†ç¡®

2. **é«˜è¡€å‹è§†ç½‘è†œè¯„ä¼°**
   - åœºæ™¯ï¼šå¿ƒè¡€ç®¡é£é™©è¯„ä¼°
   - åº”ç”¨ï¼šè¡€ç®¡å½¢æ€åˆ†æ

3. **ç”Ÿç‰©ç‰¹å¾è¯†åˆ«**
   - åœºæ™¯ï¼šèº«ä»½éªŒè¯
   - åº”ç”¨ï¼šè§†ç½‘è†œè¡€ç®¡æ¨¡å¼å”¯ä¸€

### 3.2 æŠ€æœ¯ä»·å€¼

**è§£å†³çš„é—®é¢˜ï¼š**

| é—®é¢˜ | ä¼ ç»Ÿæ–¹æ³• | Tight-Frameè§£å†³æ–¹æ¡ˆ |
|------|----------|---------------------|
| ä½å¯¹æ¯”åº¦ | é˜ˆå€¼æ³•å¤±æ•ˆ | æ¡†æ¶å¢å¼ºå¯¹æ¯” |
| å®½åº¦å˜åŒ– | å•ä¸€å°ºåº¦è¦†ç›–ä¸å…¨ | å¤šå°ºåº¦åˆ†æ |
| å™ªå£°æ•æ„Ÿ | è¾¹ç¼˜æ£€æµ‹ä¸ç¨³å®š | ç¨€ç–æ­£åˆ™å»å™ª |

**æ€§èƒ½æå‡ï¼š**

åœ¨DRIVEæ•°æ®é›†ä¸Šï¼š

| æ–¹æ³• | å‡†ç¡®ç‡ | çµæ•åº¦ | ç‰¹å¼‚æ€§ |
|------|--------|--------|--------|
| Staal et al. | 0.946 | 0.719 | 0.977 |
| Soares et al. | 0.948 | 0.733 | 0.978 |
| **æœ¬æ–‡æ–¹æ³•** | **0.952** | **0.741** | **0.981** |

### 3.3 è½åœ°å¯è¡Œæ€§

| å› ç´  | è¯„ä¼° | è¯´æ˜ |
|------|------|------|
| æ•°æ®éœ€æ±‚ | ä¸­ | éœ€è¦æ ‡æ³¨æ•°æ®é›†è®­ç»ƒ |
| è®¡ç®—èµ„æº | ä¸­ | å¯åœ¨æ™®é€šå·¥ä½œç«™è¿è¡Œ |
| éƒ¨ç½²éš¾åº¦ | ä¸­ | éœ€è¦åŒ»å­¦è®¤è¯ |

### 3.4 å•†ä¸šæ½œåŠ›

- **ç›®æ ‡å¸‚åœº**ï¼šåŒ»ç–—è®¾å¤‡ã€è¯Šæ–­è½¯ä»¶
- **ç«äº‰ä¼˜åŠ¿**ï¼šç†è®ºä¿è¯ã€é«˜å‡†ç¡®ç‡
- **äº§ä¸šåŒ–è·¯å¾„**ï¼šåŒ»é™¢ç³»ç»Ÿ â†’ äº‘ç«¯è¯Šæ–­API

---

## ğŸ¤¨ 4. è´¨ç–‘è€…Agentï¼šæ‰¹åˆ¤åˆ†æ

### 4.1 æ–¹æ³•è®ºè´¨ç–‘

**ç†è®ºå‡è®¾è¯„æï¼š**

1. **å‡è®¾ï¼šè¡€ç®¡æ˜¯æš—èƒŒæ™¯ä¸‹çš„äº®ç»“æ„**
   - è¯„æï¼šå¯¹ç—…ç†å›¾åƒä¸ä¸€å®šæˆç«‹
   - å±€é™ï¼šå‡ºè¡€ã€æ¸—å‡ºç‰©ä¼šå¹²æ‰°

2. **å‡è®¾ï¼šè¡€ç®¡æ˜¯çº¿çŠ¶ç»“æ„**
   - è¯„æï¼šåˆ†å‰ç‚¹ç»“æ„å¤æ‚
   - å±€é™ï¼šHessianå‡è®¾åœ¨åˆ†å‰ç‚¹å¤±æ•ˆ

### 4.2 å±€é™æ€§åˆ†æ

**æ–¹æ³•é™åˆ¶ï¼š**
1. ä¾èµ–äºè¡€ç®¡å’ŒèƒŒæ™¯çš„å¯¹æ¯”åº¦
2. å‚æ•°ï¼ˆJã€Î»ã€scalesï¼‰éœ€è¦è°ƒä¼˜
3. å¯¹ç—…ç†å›¾åƒæ•ˆæœä¸‹é™

**å¤±è´¥åœºæ™¯ï¼š**
- ä¸¥é‡ç—…å˜çš„è§†ç½‘è†œ
- å›¾åƒè´¨é‡å·®
- å¼‚å¸¸è¡€ç®¡å½¢æ€

### 4.3 æ”¹è¿›å»ºè®®

1. **æ·±åº¦å­¦ä¹ ç»“åˆ**ï¼šCNNå­¦ä¹ è¡€ç®¡ç‰¹å¾
2. **è‡ªé€‚åº”å‚æ•°**ï¼šæ ¹æ®å›¾åƒå†…å®¹è‡ªåŠ¨é€‰æ‹©
3. **3Dæ‰©å±•**ï¼šå¤„ç†OCTä½“æ•°æ®

---

## ğŸ¯ 5. ç»¼åˆç†è§£ï¼šæ ¸å¿ƒåˆ›æ–°ä¸æ„ä¹‰

### 5.1 æ ¸å¿ƒåˆ›æ–°ç‚¹

| ç»´åº¦ | åˆ›æ–°å†…å®¹ | åˆ›æ–°ç­‰çº§ |
|------|----------|----------|
| ç†è®º | æ¡†æ¶åŸŸMumford-Shah | â˜…â˜…â˜…â˜…â˜…â˜† |
| æ–¹æ³• | è‡ªé€‚åº”å¤šå°ºåº¦é˜ˆå€¼ | â˜…â˜…â˜…â˜…â˜† |
| åº”ç”¨ | è§†ç½‘è†œè¡€ç®¡ä¸“ç”¨ | â˜…â˜…â˜…â˜…â˜…â˜† |

### 5.2 ç ”ç©¶æ„ä¹‰

**å­¦æœ¯è´¡çŒ®ï¼š**
1. é¦–æ¬¡å°†ç´§æ¡†æ¶å¼•å…¥è¡€ç®¡åˆ†å‰²
2. å»ºç«‹äº†æ¡†æ¶-å‡ ä½•èåˆæ–¹æ³•
3. è®¾ç«‹äº†DRIVEæ•°æ®é›†åŸºå‡†

**å®é™…ä»·å€¼ï¼š**
1. ç³–å°¿ç—…è§†ç½‘è†œç—…å˜è‡ªåŠ¨ç­›æŸ¥
2. å‡è½»åŒ»ç”Ÿå·¥ä½œè´Ÿæ‹…
3. æ—©æœŸè¯Šæ–­æŒ½æ•‘è§†åŠ›

### 5.3 æŠ€æœ¯æ¼”è¿›ä½ç½®

```
[ä¼ ç»Ÿæ–¹æ³•: é˜ˆå€¼/è¾¹ç¼˜] â†’ [å°æ³¢æ–¹æ³•] â†’ [æœ¬æ–‡: Tight Frame]
     â†“                        â†“                 â†“
O(1/k)æ”¶æ•›            å¤šå°ºåº¦åˆ†æ        å†—ä½™è¡¨ç¤º+é²æ£’
                                        â†“
                              [åç»­: æ·±åº¦å­¦ä¹ æ–¹æ³•]
```

### 5.4 ç»¼åˆè¯„åˆ†

| ç»´åº¦ | è¯„åˆ† | è¯´æ˜ |
|------|------|------|
| ç†è®ºæ·±åº¦ | â˜…â˜…â˜…â˜…â˜…â˜† | æ¡†æ¶ç†è®ºæ‰å® |
| æ–¹æ³•åˆ›æ–° | â˜…â˜…â˜…â˜…â˜† | å¤šå°ºåº¦èåˆ |
| å®ç°éš¾åº¦ | â˜…â˜…â˜…â˜†â˜† | ä¸­ç­‰ |
| åº”ç”¨ä»·å€¼ | â˜…â˜…â˜…â˜…â˜…â˜† | åŒ»å­¦ä»·å€¼æé«˜ |

**æ€»åˆ†ï¼šâ˜…â˜…â˜…â˜…â˜† (4.3/5.0)**

---

## ğŸ“š å‚è€ƒæ–‡çŒ®

1. Cai, X., et al. (2011). Retinal vessel segmentation using tight frame and multi-scale analysis. IEEE TMI.
2. Frangi, A., et al. (1998). Multiscale vessel enhancement filtering.
3. Daubechies, I. (1992). Ten lectures on wavelets.

---

## ğŸ“ ä¸ªäººç†è§£ç¬”è®°

```
æ ¸å¿ƒæ´å¯Ÿ:

1. æ¡†æ¶ vs å°æ³¢ï¼š
   - å°æ³¢ï¼šæ­£äº¤åŸºï¼Œæ— å†—ä½™ï¼Œä¸´ç•Œé‡‡æ ·
   - æ¡†æ¶ï¼šå†—ä½™è¡¨ç¤ºï¼Œé²æ£’æ€§å¼º
   - Tight Frameï¼šæ¡†æ¶ç•ŒA=B=1ï¼Œå®Œç¾é‡æ„

2. ä¸ºä»€ä¹ˆé€‰æ‹©æ¡†æ¶ï¼š
   - è§†ç½‘è†œå›¾åƒå™ªå£°å¤§ï¼ˆç›¸æœºå™ªå£°ã€æˆåƒä¼ªå½±ï¼‰
   - æ¡†æ¶å†—ä½™æ€§æä¾›æŠ—å™ªèƒ½åŠ›
   - å¤šå°ºåº¦æ•è·ä¸åŒå®½åº¦è¡€ç®¡

3. å¤šå°ºåº¦çš„é‡è¦æ€§ï¼š
   - å¤§è¡€ç®¡ï¼šç²—å°ºåº¦æ£€æµ‹
   - å°è¡€ç®¡ï¼šç»†å°ºåº¦æ£€æµ‹
   - å•ä¸€å°ºåº¦æ— æ³•å…¼é¡¾

4. Hessiançš„ä½œç”¨ï¼š
   - è¡€ç®¡çš„å‡ ä½•ç‰¹å¾ï¼šçº¿çŠ¶ï¼ˆç»†é•¿ï¼‰â†’ Hessianç‰¹å¾å€¼ä¸€ä¸ªæ¥è¿‘0
   - èƒŒæ™¯å™ªå£°ï¼šæ–‘ç‚¹çŠ¶ â†’ ä¸¤ä¸ªç‰¹å¾å€¼éƒ½å¤§
   - é€šè¿‡ç‰¹å¾å€¼åˆ†æåŒºåˆ†è¡€ç®¡å’Œå™ªå£°

5. åŒ»å­¦æ„ä¹‰ï¼š
   - ç³–å°¿ç—…è§†ç½‘è†œç—…å˜æ˜¯ä¸»è¦è‡´ç›²åŸå› ä¹‹ä¸€
   - æ—©æœŸç­›æŸ¥å¯ä»¥é¢„é˜²
   - è‡ªåŠ¨åŒ–åˆ†å‰²å¯ä»¥å¤§è§„æ¨¡ç­›æŸ¥
```

---

*æœ¬ç¬”è®°ç”±5-Agentè¾©è®ºåˆ†æç³»ç»Ÿç”Ÿæˆï¼Œç»“åˆè¯¦ç»†ç‰ˆç¬”è®°è¿›è¡Œæ·±å…¥åˆ†æã€‚*
