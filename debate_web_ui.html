<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤šæ™ºèƒ½ä½“è®ºæ–‡è¾©è®ºç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e0e0e0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 30px;
        }

        header h1 {
            font-size: 2.5em;
            background: linear-gradient(90deg, #00d4ff, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        header p {
            color: #888;
            font-size: 1.1em;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 20px;
        }

        .panel {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .panel h2 {
            font-size: 1.2em;
            margin-bottom: 15px;
            color: #00d4ff;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #aaa;
            font-size: 0.9em;
        }

        .input-group input,
        .input-group textarea,
        .input-group select {
            width: 100%;
            padding: 12px;
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            color: #fff;
            font-size: 0.95em;
        }

        .input-group textarea {
            min-height: 150px;
            resize: vertical;
        }

        .input-group input:focus,
        .input-group textarea:focus,
        .input-group select:focus {
            outline: none;
            border-color: #00d4ff;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00d4ff, #7c3aed);
            color: #fff;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0,212,255,0.3);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #fff;
        }

        .btn-secondary:hover {
            background: rgba(255,255,255,0.2);
        }

        .agent-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .agent-card {
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s;
            cursor: pointer;
        }

        .agent-card:hover {
            border-color: #00d4ff;
            background: rgba(0,212,255,0.1);
        }

        .agent-card.active {
            border-color: #7c3aed;
            background: rgba(124,58,237,0.2);
        }

        .agent-icon {
            font-size: 2em;
            margin-bottom: 8px;
        }

        .agent-name {
            font-size: 0.9em;
            color: #ccc;
        }

        .debate-area {
            min-height: 500px;
        }

        .debate-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .debate-info {
            display: flex;
            gap: 20px;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-label {
            color: #888;
            font-size: 0.85em;
        }

        .info-value {
            color: #00d4ff;
            font-weight: 500;
        }

        .messages {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .messages::-webkit-scrollbar {
            width: 6px;
        }

        .messages::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
            border-radius: 3px;
        }

        .messages::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
        }

        .message {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255,255,255,0.03);
            border-radius: 10px;
            border-left: 3px solid;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.mathematician { border-color: #ff6b6b; }
        .message.engineer { border-color: #4ecdc4; }
        .message.application_expert { border-color: #ffe66d; }
        .message.skeptic { border-color: #ff8fd8; }
        .message.synthesizer { border-color: #7c3aed; }

        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .message-author {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .message-role {
            padding: 4px 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            font-size: 0.75em;
            color: #888;
        }

        .message-time {
            color: #666;
            font-size: 0.8em;
        }

        .message-content {
            line-height: 1.6;
            color: #ccc;
        }

        .message-content p {
            margin-bottom: 10px;
        }

        .round-indicator {
            text-align: center;
            padding: 10px;
            margin: 20px 0;
            background: rgba(0,212,255,0.1);
            border-radius: 8px;
            color: #00d4ff;
            font-weight: 500;
        }

        .progress-bar {
            height: 4px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00d4ff, #7c3aed);
            transition: width 0.3s;
        }

        .consensus-meter {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .meter-bar {
            flex: 1;
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .meter-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #ffe66d, #4ecdc4);
            transition: width 0.5s;
        }

        .meter-value {
            font-weight: 500;
            min-width: 50px;
        }

        .status-badge {
            padding: 6px 12px;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            font-size: 0.85em;
        }

        .status-badge.in-progress {
            background: rgba(0,212,255,0.2);
            color: #00d4ff;
        }

        .status-badge.completed {
            background: rgba(78,205,196,0.2);
            color: #4ecdc4;
        }

        .typing-indicator {
            display: flex;
            gap: 5px;
            padding: 15px;
            color: #888;
        }

        .typing-indicator span {
            width: 8px;
            height: 8px;
            background: #888;
            border-radius: 50%;
            animation: bounce 1.4s infinite;
        }

        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes bounce {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        .output-section {
            margin-top: 20px;
        }

        .output-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .output-tab {
            padding: 10px 20px;
            background: rgba(255,255,255,0.05);
            border: none;
            border-radius: 8px;
            color: #888;
            cursor: pointer;
            transition: all 0.3s;
        }

        .output-tab:hover {
            background: rgba(255,255,255,0.1);
        }

        .output-tab.active {
            background: rgba(0,212,255,0.2);
            color: #00d4ff;
        }

        .output-content {
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 20px;
            min-height: 200px;
            font-family: 'Consolas', monospace;
            font-size: 0.9em;
            white-space: pre-wrap;
            color: #ccc;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>å¤šæ™ºèƒ½ä½“è®ºæ–‡è¾©è®ºç³»ç»Ÿ</h1>
            <p>Multi-Agent Paper Debate System</p>
        </header>

        <div class="main-grid">
            <!-- å·¦ä¾§æ§åˆ¶é¢æ¿ -->
            <div class="left-panel">
                <div class="panel">
                    <h2>ğŸ“„ è®ºæ–‡ä¿¡æ¯</h2>

                    <div class="input-group">
                        <label>è®ºæ–‡æ ‡é¢˜</label>
                        <input type="text" id="paperTitle" placeholder="è¾“å…¥è®ºæ–‡æ ‡é¢˜...">
                    </div>

                    <div class="input-group">
                        <label>ä½œè€…</label>
                        <input type="text" id="paperAuthors" placeholder="è¾“å…¥ä½œè€…ï¼Œé€—å·åˆ†éš”...">
                    </div>

                    <div class="input-group">
                        <label>è®ºæ–‡å†…å®¹</label>
                        <textarea id="paperContent" placeholder="ç²˜è´´è®ºæ–‡å†…å®¹..."></textarea>
                    </div>

                    <button class="btn btn-primary" style="width: 100%" onclick="loadSamplePaper()">
                        åŠ è½½ç¤ºä¾‹è®ºæ–‡
                    </button>
                </div>

                <div class="panel" style="margin-top: 20px;">
                    <h2>ğŸ¤– Agenté…ç½®</h2>

                    <div class="agent-grid">
                        <div class="agent-card active" data-agent="mathematician" onclick="toggleAgent(this)">
                            <div class="agent-icon">ğŸ“</div>
                            <div class="agent-name">æ•°å­¦å®¶</div>
                        </div>
                        <div class="agent-card active" data-agent="engineer" onclick="toggleAgent(this)">
                            <div class="agent-icon">âš™ï¸</div>
                            <div class="agent-name">å·¥ç¨‹å¸ˆ</div>
                        </div>
                        <div class="agent-card active" data-agent="application_expert" onclick="toggleAgent(this)">
                            <div class="agent-icon">ğŸ’¼</div>
                            <div class="agent-name">åº”ç”¨ä¸“å®¶</div>
                        </div>
                        <div class="agent-card active" data-agent="skeptic" onclick="toggleAgent(this)">
                            <div class="agent-icon">ğŸ”</div>
                            <div class="agent-name">è´¨ç–‘è€…</div>
                        </div>
                        <div class="agent-card active" data-agent="synthesizer" onclick="toggleAgent(this)">
                            <div class="agent-icon">ğŸ“Š</div>
                            <div class="agent-name">ç»¼åˆè€…</div>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>æœ€å¤§è½®æ¬¡</label>
                        <select id="maxRounds">
                            <option value="1">1è½®ï¼ˆå¿«é€Ÿï¼‰</option>
                            <option value="3" selected>3è½®ï¼ˆæ ‡å‡†ï¼‰</option>
                            <option value="5">5è½®ï¼ˆæ·±åº¦ï¼‰</option>
                        </select>
                    </div>

                    <button class="btn btn-primary" style="width: 100%" onclick="startDebate()">
                        å¼€å§‹è¾©è®º
                    </button>
                </div>
            </div>

            <!-- å³ä¾§è¾©è®ºåŒºåŸŸ -->
            <div class="panel debate-area">
                <div class="debate-header">
                    <div class="debate-info">
                        <div class="info-item">
                            <span class="info-label">çŠ¶æ€</span>
                            <span class="status-badge" id="statusBadge">ç­‰å¾…å¼€å§‹</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">è½®æ¬¡</span>
                            <span class="info-value" id="currentRound">0 / 0</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">å‘è¨€æ•°</span>
                            <span class="info-value" id="messageCount">0</span>
                        </div>
                    </div>

                    <div class="consensus-meter">
                        <span class="info-label">å…±è¯†åº¦</span>
                        <div class="meter-bar">
                            <div class="meter-fill" id="consensusFill" style="width: 0%"></div>
                        </div>
                        <span class="meter-value" id="consensusValue">0%</span>
                    </div>
                </div>

                <div class="messages" id="messagesContainer">
                    <div style="text-align: center; color: #666; padding: 50px 0;">
                        <p>é…ç½®è®ºæ–‡ä¿¡æ¯åç‚¹å‡»"å¼€å§‹è¾©è®º"</p>
                    </div>
                </div>

                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>

                <div class="output-section">
                    <div class="output-tabs">
                        <button class="output-tab active" onclick="showOutput('log')">è¾©è®ºè®°å½•</button>
                        <button class="output-tab" onclick="showOutput('report')">æœ€ç»ˆæŠ¥å‘Š</button>
                        <button class="output-tab" onclick="showOutput('json')">JSONæ•°æ®</button>
                    </div>
                    <div class="output-content" id="outputContent">
                        è¾©è®ºç»“æŸåå°†æ˜¾ç¤ºè¾“å‡ºå†…å®¹...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ç¤ºä¾‹è®ºæ–‡æ•°æ®
        const samplePaper = {
            title: "åŸºäº Mumford-Shah æ³›å‡½çš„å‡¸æ¾å¼›å›¾åƒåˆ†å‰²æ–¹æ³•",
            authors: "Xiaohao Cai, å…¶ä»–ä½œè€…",
            content: `# å¼•è¨€

Mumford-Shahæ³›å‡½æ˜¯å›¾åƒåˆ†å‰²çš„ç»å…¸æ–¹æ³•ï¼Œä½†åŸå§‹é—®é¢˜æ˜¯éå‡¸çš„ï¼Œå®¹æ˜“é™·å…¥å±€éƒ¨æœ€ä¼˜ã€‚

# æ–¹æ³•

## 2.1 Mumford-Shahæ³›å‡½

åŸå§‹MSæ³›å‡½å®šä¹‰ä¸ºï¼š

E(u, K) = âˆ«_Î©\\K |âˆ‡u|^2 dx + Î¼ âˆ«_Î©|f-u|^2 dx + Î½ H^{d-1}(K)

å…¶ä¸­ï¼š
- u æ˜¯åˆ†æ®µå…‰æ»‘å‡½æ•°
- K æ˜¯è¾¹ç¼˜é›†
- H^{d-1} æ˜¯Hausdorffæµ‹åº¦

## 2.2 å‡¸æ¾å¼›

æˆ‘ä»¬æå‡ºä»¥ä¸‹å‡¸æ¾å¼›å½¢å¼ï¼š

min_{uâˆˆBV(Î©)} âˆ«_Î© |âˆ‡u| + Î» âˆ«_Î© (u-f)^2 dx

## 2.3 æ•°å€¼ç®—æ³•

ä½¿ç”¨åŸå§‹å¯¹å¶ç®—æ³•æ±‚è§£ï¼š
- åŸå§‹æ­¥ï¼šu^{k+1} = (I + Î»âˆ‚F)^{-1}(f - p^k)
- å¯¹å¶æ­¥ï¼šp^{k+1} = (p^k + Ï„âˆ‡u^{k+1})/(1+Ï„|âˆ‡u^{k+1}|)

# å®éªŒ

åœ¨åŒ»å­¦å›¾åƒæ•°æ®é›†ä¸Šè¯„ä¼°ï¼š
- è„‘éƒ¨MRIåˆ†å‰²ï¼šDiceç³»æ•°0.92
- å‰åˆ—è…ºCTåˆ†å‰²ï¼šDiceç³»æ•°0.88

# ç»“è®º

æœ¬æ–‡æå‡ºçš„å‡¸æ¾å¼›æ–¹æ³•æœ‰æ•ˆè§£å†³äº†MSæ³›å‡½çš„éå‡¸é—®é¢˜ã€‚`
        };

        // çŠ¶æ€ç®¡ç†
        let state = {
            isRunning: false,
            currentRound: 0,
            maxRounds: 3,
            messages: [],
            consensus: 0
        };

        // Agenté…ç½®
        let activeAgents = ['mathematician', 'engineer', 'application_expert', 'skeptic', 'synthesizer'];

        const agentNames = {
            mathematician: 'æ•°å­¦å®¶',
            engineer: 'å·¥ç¨‹å¸ˆ',
            application_expert: 'åº”ç”¨ä¸“å®¶',
            skeptic: 'è´¨ç–‘è€…',
            synthesizer: 'ç»¼åˆè€…'
        };

        // åŠ è½½ç¤ºä¾‹è®ºæ–‡
        function loadSamplePaper() {
            document.getElementById('paperTitle').value = samplePaper.title;
            document.getElementById('paperAuthors').value = samplePaper.authors;
            document.getElementById('paperContent').value = samplePaper.content;
        }

        // åˆ‡æ¢Agent
        function toggleAgent(element) {
            const agent = element.dataset.agent;
            element.classList.toggle('active');

            if (activeAgents.includes(agent)) {
                activeAgents = activeAgents.filter(a => a !== agent);
            } else {
                activeAgents.push(agent);
            }
        }

        // å¼€å§‹è¾©è®º
        async function startDebate() {
            const title = document.getElementById('paperTitle').value;
            const content = document.getElementById('paperContent').value;

            if (!title || !content) {
                alert('è¯·è¾“å…¥è®ºæ–‡æ ‡é¢˜å’Œå†…å®¹');
                return;
            }

            state.isRunning = true;
            state.maxRounds = parseInt(document.getElementById('maxRounds').value);
            state.currentRound = 0;
            state.messages = [];

            updateStatus('in-progress');
            clearMessages();

            // æ¨¡æ‹Ÿè¾©è®ºè¿‡ç¨‹
            for (let round = 1; round <= state.maxRounds; round++) {
                state.currentRound = round;
                addRoundIndicator(round);

                for (const agent of activeAgents) {
                    if (agent === 'synthesizer' && round < state.maxRounds) continue;

                    await simulateMessage(agent, round);
                    updateProgress();
                }

                // æ›´æ–°å…±è¯†åº¦
                state.consensus = Math.min(0.95, state.consensus + 0.15 + Math.random() * 0.1);
                updateConsensus();
            }

            // ç»¼åˆè€…ç”ŸæˆæŠ¥å‘Š
            if (activeAgents.includes('synthesizer')) {
                await simulateMessage('synthesizer', state.maxRounds + 1);
            }

            state.isRunning = false;
            updateStatus('completed');
            generateOutputs();
        }

        // æ¨¡æ‹ŸAgentå‘è¨€
        async function simulateMessage(agent, round) {
            showTypingIndicator();

            await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 2000));

            hideTypingIndicator();

            const content = generateMockContent(agent, round);
            addMessage(agent, content, round);
        }

        // ç”Ÿæˆæ¨¡æ‹Ÿå†…å®¹
        function generateMockContent(agent, round) {
            const templates = {
                mathematician: [
                    "ä»æ•°å­¦ç†è®ºè§’åº¦æ¥çœ‹ï¼Œè®ºæ–‡ä¸­æå‡ºçš„å‡¸æ¾å¼›æ–¹æ³•åœ¨ç†è®ºä¸Šæ˜¯åˆç†çš„ã€‚ä½†æˆ‘æ³¨æ„åˆ°ï¼Œå¯¹äºHausdorffæµ‹åº¦çš„ç¦»æ•£åŒ–å¤„ç†ç¼ºä¹ä¸¥æ ¼çš„æ”¶æ•›æ€§è¯æ˜ã€‚",
                    "å…³äºåŸå§‹å¯¹å¶ç®—æ³•çš„æ”¶æ•›æ€§åˆ†æï¼Œè®ºæ–‡åªç»™å‡ºäº†å®éªŒç»“æœï¼Œæ²¡æœ‰ç†è®ºä¿è¯ã€‚å»ºè®®è¡¥å……æ”¶æ•›ç‡çš„ç†è®ºåˆ†æã€‚",
                    "å…¬å¼(2.2)ä¸­çš„æ­£åˆ™åŒ–å‚æ•°Î»çš„é€‰æ‹©ç¼ºä¹ç†è®ºæŒ‡å¯¼ã€‚æ˜¯å¦å¯ä»¥é€šè¿‡è´å¶æ–¯è§‚ç‚¹ç»™å‡ºæœ€ä¼˜å‚æ•°çš„ç†è®ºæ¨å¯¼ï¼Ÿ"
                ],
                engineer: [
                    "ä»å·¥ç¨‹å®ç°è§’åº¦ï¼ŒåŸå§‹å¯¹å¶ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(n^2)ï¼Œå¯¹äºå¤§å°ºå¯¸åŒ»å­¦å›¾åƒå¯èƒ½è¾ƒæ…¢ã€‚å»ºè®®è€ƒè™‘å¤šå°ºåº¦åŠ é€Ÿç­–ç•¥ã€‚",
                    "ç®—æ³•å®ç°ä¸­æ¶‰åŠçš„æ¢¯åº¦è®¡ç®—å¯èƒ½å­˜åœ¨æ•°å€¼ä¸ç¨³å®šé—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨å›¾åƒè¾¹ç¼˜åŒºåŸŸã€‚éœ€è¦æ·»åŠ æ•°å€¼ç¨³å®šåŒ–å¤„ç†ã€‚",
                    "ä»£ç å¤ç°éœ€è¦æ˜ç¡®ç®—æ³•çš„å…·ä½“å‚æ•°è®¾ç½®ï¼ˆå¦‚Ï„, Ïƒç­‰ï¼‰ï¼Œè®ºæ–‡ä¸­å¯¹æ­¤æè¿°ä¸å¤Ÿè¯¦ç»†ã€‚"
                ],
                application_expert: [
                    "è¯¥æ–¹æ³•åœ¨åŒ»å­¦å›¾åƒåˆ†å‰²é¢†åŸŸæœ‰å¾ˆå¥½çš„åº”ç”¨å‰æ™¯ã€‚Diceç³»æ•°0.92çš„ç»“æœè¡¨æ˜æ–¹æ³•å…·æœ‰ä¸´åºŠå®ç”¨ä»·å€¼ã€‚",
                    "æ•°æ®é›†è§„æ¨¡ç›¸å¯¹è¾ƒå°ï¼ˆä»…æåˆ°åŒ»å­¦å›¾åƒæ•°æ®é›†ï¼‰ï¼Œå»ºè®®åœ¨æ›´å¤šå…¬å¼€æ•°æ®é›†ä¸ŠéªŒè¯æ³›åŒ–æ€§èƒ½ã€‚",
                    "ä¸ç°æœ‰ä¸´åºŠå·¥ä½œæµç¨‹çš„é›†æˆæ˜¯å…³é”®ã€‚éœ€è¦è€ƒè™‘ç®—æ³•çš„å®æ—¶æ€§å’Œå¯¹æ ‡æ³¨æ•°æ®çš„ä¾èµ–ç¨‹åº¦ã€‚"
                ],
                skeptic: [
                    "è®ºæ–‡å£°ç§°åœ¨ä¸¤ä¸ªæ•°æ®é›†ä¸Šå–å¾—äº†ä¼˜ç§€ç»“æœï¼Œä½†ç¼ºä¹ä¸å…¶ä»–æ–¹æ³•çš„å…¬å¹³å¯¹æ¯”ã€‚å®éªŒè®¾ç½®å¯èƒ½å­˜åœ¨cherry-pickingã€‚",
                    "Diceç³»æ•°0.92çœ‹èµ·æ¥å¾ˆé«˜ï¼Œä½†éœ€è¦çœ‹å…·ä½“çš„æµ‹è¯•æ ·æœ¬æ•°é‡å’Œç»Ÿè®¡æ˜¾è‘—æ€§æ£€éªŒç»“æœã€‚",
                    "æ²¡æœ‰æŠ¥å‘Šå¤±è´¥æ¡ˆä¾‹çš„åˆ†æã€‚æ‰€æœ‰æ ·æœ¬éƒ½èƒ½æˆåŠŸåˆ†å‰²å—ï¼Ÿè¾¹ç¼˜æƒ…å†µå¦‚ä½•å¤„ç†ï¼Ÿ"
                ],
                synthesizer: [
                    "**è¾©è®ºæ€»ç»“**\n\nç»è¿‡å¤šè½®è®¨è®ºï¼Œå„æ–¹è¾¾æˆä»¥ä¸‹å…±è¯†ï¼š\n\n1. ç†è®ºåŸºç¡€æ‰å®ï¼Œä½†éœ€è¦è¡¥å……æ”¶æ•›æ€§è¯æ˜\n2. å·¥ç¨‹å®ç°å¯è¡Œï¼Œä½†éœ€è¦ä¼˜åŒ–è®¡ç®—æ•ˆç‡\n3. åŒ»å­¦åº”ç”¨å‰æ™¯è‰¯å¥½ï¼Œä½†éœ€è¦æ›´å¤šå®éªŒéªŒè¯\n\n**ä¸»è¦åˆ†æ­§**ï¼š\n- å‚æ•°é€‰æ‹©çš„ç†è®ºæŒ‡å¯¼\n- å®éªŒå¯¹æ¯”çš„å…¬å¹³æ€§\n\n**æœ€ç»ˆè¯„ä¼°**ï¼šè¯¥è®ºæ–‡æå‡ºäº†æœ‰ä»·å€¼çš„å‡¸æ¾å¼›æ–¹æ³•ï¼Œä½†åœ¨ç†è®ºå®Œæ•´æ€§å’Œå®éªŒå…¨é¢æ€§æ–¹é¢ä»æœ‰æ”¹è¿›ç©ºé—´ã€‚å»ºè®®ä½œè€…è¡¥å……ç†è®ºè¯æ˜å’Œæ›´å…¨é¢çš„å¯¹æ¯”å®éªŒã€‚"
                ]
            };

            const agentTemplates = templates[agent] || [];
            const index = Math.floor(Math.random() * agentTemplates.length);
            return agentTemplates[index] || "è¿™æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿçš„åˆ†æå†…å®¹...";
        }

        // æ·»åŠ æ¶ˆæ¯åˆ°ç•Œé¢
        function addMessage(agent, content, round) {
            const container = document.getElementById('messagesContainer');
            const messageEl = document.createElement('div');
            messageEl.className = `message ${agent}`;

            const time = new Date().toLocaleTimeString();

            messageEl.innerHTML = `
                <div class="message-header">
                    <div class="message-author">
                        ${getAgentIcon(agent)}
                        ${agentNames[agent]}
                    </div>
                    <div class="message-role">ç¬¬${round}è½®</div>
                </div>
                <div class="message-content">${content}</div>
            `;

            container.appendChild(messageEl);
            container.scrollTop = container.scrollHeight;

            state.messages.push({ agent, content, round, time });
            document.getElementById('messageCount').textContent = state.messages.length;
        }

        // è·å–Agentå›¾æ ‡
        function getAgentIcon(agent) {
            const icons = {
                mathematician: 'ğŸ“',
                engineer: 'âš™ï¸',
                application_expert: 'ğŸ’¼',
                skeptic: 'ğŸ”',
                synthesizer: 'ğŸ“Š'
            };
            return icons[agent] || 'ğŸ¤–';
        }

        // æ·»åŠ è½®æ¬¡æŒ‡ç¤ºå™¨
        function addRoundIndicator(round) {
            const container = document.getElementById('messagesContainer');
            const indicator = document.createElement('div');
            indicator.className = 'round-indicator';
            indicator.textContent = round === 1 ? 'ç¬¬ä¸€è½®ï¼šç‹¬ç«‹åˆ†æå‘è¨€' : `ç¬¬${round}è½®ï¼šäº¤äº’è¾©è®º`;
            container.appendChild(indicator);
        }

        // æ˜¾ç¤ºè¾“å…¥æŒ‡ç¤ºå™¨
        function showTypingIndicator() {
            const container = document.getElementById('messagesContainer');
            const indicator = document.createElement('div');
            indicator.className = 'typing-indicator';
            indicator.id = 'typingIndicator';
            indicator.innerHTML = '<span></span><span></span><span></span>';
            container.appendChild(indicator);
            container.scrollTop = container.scrollHeight;
        }

        // éšè—è¾“å…¥æŒ‡ç¤ºå™¨
        function hideTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) indicator.remove();
        }

        // æ¸…ç©ºæ¶ˆæ¯
        function clearMessages() {
            document.getElementById('messagesContainer').innerHTML = '';
            state.messages = [];
        }

        // æ›´æ–°çŠ¶æ€
        function updateStatus(status) {
            const badge = document.getElementById('statusBadge');
            badge.className = 'status-badge';

            if (status === 'in-progress') {
                badge.classList.add('in-progress');
                badge.textContent = 'è¾©è®ºä¸­';
            } else if (status === 'completed') {
                badge.classList.add('completed');
                badge.textContent = 'å·²å®Œæˆ';
            } else {
                badge.textContent = 'ç­‰å¾…å¼€å§‹';
            }
        }

        // æ›´æ–°è½®æ¬¡æ˜¾ç¤º
        function updateProgress() {
            document.getElementById('currentRound').textContent =
                `${state.currentRound} / ${state.maxRounds}`;
            const progress = (state.currentRound / state.maxRounds) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
        }

        // æ›´æ–°å…±è¯†åº¦
        function updateConsensus() {
            const value = Math.round(state.consensus * 100);
            document.getElementById('consensusValue').textContent = `${value}%`;
            document.getElementById('consensusFill').style.width = `${value}%`;
        }

        // ç”Ÿæˆè¾“å‡º
        function generateOutputs() {
            const logOutput = generateDebateLog();
            const reportOutput = generateFinalReport();
            const jsonOutput = JSON.stringify({
                paper: document.getElementById('paperTitle').value,
                rounds: state.currentRound,
                messages: state.messages,
                consensus: state.consensus
            }, null, 2);

            window.outputs = {
                log: logOutput,
                report: reportOutput,
                json: jsonOutput
            };

            document.getElementById('outputContent').textContent = logOutput;
        }

        // ç”Ÿæˆè¾©è®ºè®°å½•
        function generateDebateLog() {
            let log = `# è®ºæ–‡è¾©è®ºè®°å½•ï¼š${document.getElementById('paperTitle').value}\n\n`;
            log += `**è¾©è®ºæ—¶é—´**: ${new Date().toLocaleString()}\n`;
            log += `**å‚ä¸Agent**: ${activeAgents.map(a => agentNames[a]).join(', ')}\n`;
            log += `**æ€»è½®æ¬¡**: ${state.currentRound}\n`;
            log += `**å…±è¯†åº¦**: ${state.consensus.toFixed(2)}\n\n`;

            let currentRound = 0;
            for (const msg of state.messages) {
                if (msg.round > currentRound) {
                    currentRound = msg.round;
                    log += `\n## ç¬¬${currentRound}è½®\n\n`;
                }
                log += `### ${agentNames[msg.agent]}\n${msg.content}\n\n`;
            }

            return log;
        }

        // ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š
        function generateFinalReport() {
            let report = `# è®ºæ–‡æ·±åº¦ç†è§£æŠ¥å‘Šï¼š${document.getElementById('paperTitle').value}\n\n`;
            report += `**ç”Ÿæˆæ—¶é—´**: ${new Date().toLocaleString()}\n`;
            report += `**å…±è¯†åº¦è¯„åˆ†**: ${'â­'.repeat(Math.round(state.consensus * 5))} (${state.consensus.toFixed(2)}/1.0)\n\n`;

            report += `## 1. æ ¸å¿ƒè´¡çŒ®\n`;
            report += `- æå‡ºäº†åŸºäºå‡¸æ¾å¼›çš„å›¾åƒåˆ†å‰²æ–¹æ³•\n`;
            report += `- ä½¿ç”¨åŸå§‹å¯¹å¶ç®—æ³•é«˜æ•ˆæ±‚è§£\n\n`;

            report += `## 2. ä¸»è¦ä¼˜åŠ¿\n`;
            report += `- ç†è®ºåŸºç¡€ï¼šå‡¸ä¼˜åŒ–ä¿è¯å…¨å±€æœ€ä¼˜\n`;
            report += `- å®éªŒç»“æœï¼šåŒ»å­¦å›¾åƒåˆ†å‰²è¡¨ç°ä¼˜å¼‚\n\n`;

            report += `## 3. ä¸»è¦å±€é™\n`;
            report += `- ç¼ºä¹æ”¶æ•›æ€§ç†è®ºè¯æ˜\n`;
            report += `- è®¡ç®—æ•ˆç‡æœ‰å¾…æé«˜\n`;
            report += `- å®éªŒå¯¹æ¯”ä¸å¤Ÿå…¨é¢\n\n`;

            report += `## 4. è¾©è®ºç»Ÿè®¡\n`;
            report += `- æ€»å‘è¨€æ•°: ${state.messages.length}\n`;
            report += `- è¾©è®ºè½®æ¬¡: ${state.currentRound}\n`;

            return report;
        }

        // åˆ‡æ¢è¾“å‡ºæ˜¾ç¤º
        function showOutput(type) {
            document.querySelectorAll('.output-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            if (window.outputs) {
                document.getElementById('outputContent').textContent = window.outputs[type] || '';
            }
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            loadSamplePaper();
        });
    </script>
</body>
</html>
