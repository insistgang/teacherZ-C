# 论文精读（超详细版）：[4-12] 球面小波分割

> **论文标题**: Spherical Wavelet Segmentation on the Sphere  
> **期刊**: IEEE Transactions on Signal Processing, 2018  
> **作者**: Xiaohao Cai, et al.  
> **精读深度**: ⭐⭐⭐⭐⭐（球面几何+小波变换+特殊域分割）

---

## 一、背景：球面数据处理

### 1.1 为什么需要球面分割？

**应用场景**：
- 全景图像
- 地球科学数据
- 天文观测
- 脑皮层分析

**挑战**：
- 球面不是欧氏空间
- 标准卷积/小波不适用
- 边界条件复杂

### 1.2 球面几何基础

**球坐标**：
$$(\theta, \phi), \quad \theta \in [0, \pi], \phi \in [0, 2\pi)$$

**球面度量**：
$$ds^2 = d\theta^2 + \sin^2\theta \, d\phi^2$$

**球面拉普拉斯**：
$$\Delta_S f = \frac{1}{\sin\theta} \frac{\partial}{\partial \theta}\left(\sin\theta \frac{\partial f}{\partial \theta}\right) + \frac{1}{\sin^2\theta} \frac{\partial^2 f}{\partial \phi^2}$$

---

## 二、球面小波变换

### 2.1 球谐函数（Spherical Harmonics）

**定义**：
球谐函数 $Y_l^m(\theta, \phi)$ 是球面拉普拉斯的特征函数。

**性质**：
- 正交完备
- 类似傅里叶基

**函数展开**：
$$f(\theta, \phi) = \sum_{l=0}^{\infty} \sum_{m=-l}^{l} a_{lm} Y_l^m(\theta, \phi)$$

### 2.2 球面小波

**构造**：
通过球谐函数构造小波。

**小波函数**：
$$\psi_{j,k}(\theta, \phi) = \sum_{l} b\left(\frac{l}{2^j}\right) Y_l^k(\theta, \phi)$$

其中 $b$ 是带通滤波器。

### 2.3 数值实现

```python
import pyshtools  # 球谐函数库

def spherical_wavelet_transform(data, max_degree=256):
    """
    球面小波变换
    
    参数:
        data: (nlat, nlon) 球面数据
        max_degree: 最大球谐阶数
    
    返回:
        coefficients: 小波系数
    """
    # 扩展为球谐系数
    coeffs = pyshtools.expand.SHExpandDH(data, sampling=2, lmax_calc=max_degree)
    
    # 多尺度分解
    wavelet_coeffs = []
    
    for j in range(num_scales):
        scale = 2**j
        
        # 带通滤波
        band_coeffs = apply_spherical_bandpass(coeffs, scale)
        
        wavelet_coeffs.append(band_coeffs)
    
    return wavelet_coeffs

def apply_spherical_bandpass(coeffs, scale):
    """球面带通滤波"""
    filtered = coeffs.copy()
    
    lmax = coeffs.lmax
    for l in range(lmax + 1):
        # 小波滤波器
        if scale <= l < 2 * scale:
            pass  # 保留
        else:
            # 置零
            filtered.coeffs[0, l, :] = 0
            filtered.coeffs[1, l, :] = 0
    
    return filtered
```

---

## 三、球面分割模型

### 3.1 能量泛函

$$E(u) = \int_{S^2} (u - f)^2 d\Omega + \lambda \int_{S^2} |\nabla_S u| d\Omega$$

其中：
- $S^2$：单位球面
- $\nabla_S$：球面梯度
- $d\Omega = \sin\theta \, d\theta \, d\phi$

### 3.2 球面TV

$$TV_S(u) = \int_{S^2} |\nabla_S u| d\Omega$$

### 3.3 数值求解

```python
def spherical_tv_denoise(data, lambda_param, max_iter=100):
    """
    球面TV去噪
    """
    u = data.copy()
    
    for iter in range(max_iter):
        # 球面梯度
        grad_theta, grad_phi = compute_spherical_gradient(u)
        
        # 梯度模
        grad_mag = np.sqrt(grad_theta**2 + grad_phi**2 + 1e-10)
        
        # 曲率（散度）
        curvature = compute_spherical_divergence(grad_theta / grad_mag, 
                                                 grad_phi / grad_mag)
        
        # 更新
        u = u + dt * ((data - u) + lambda_param * curvature)
    
    return u

def compute_spherical_gradient(field):
    """计算球面梯度"""
    nlat, nlon = field.shape
    
    # d/dtheta
    grad_theta = np.gradient(field, axis=0)
    
    # d/dphi
    grad_phi = np.gradient(field, axis=1)
    
    # 考虑度量
    theta = np.linspace(0, np.pi, nlat)
    theta_grid = np.tile(theta[:, None], (1, nlon))
    
    grad_phi = grad_phi / (np.sin(theta_grid) + 1e-10)
    
    return grad_theta, grad_phi
```

---


### 4.1 全景摄像头

**场景**：
- 车载全景摄像头
- 360度视野

### 4.2 球面到平面的映射

```python
def spherical_to_planar(spherical_image, fov=120):
    """
    将球面图像映射到平面（透视投影）
    
    便于应用标准算法
    """
    nlat, nlon = spherical_image.shape
    
    # 输出平面图像
    h, w = 512, 512
    planar = np.zeros((h, w))
    
    # 中心视角
    center_theta = np.pi / 2
    center_phi = np.pi
    
    for i in range(h):
        for j in range(w):
            # 平面坐标到球面坐标
            x = (j - w/2) / (w/2) * np.tan(np.radians(fov)/2)
            y = (i - h/2) / (h/2) * np.tan(np.radians(fov)/2)
            
            # 3D方向
            z = 1
            norm = np.sqrt(x**2 + y**2 + z**2)
            x, y, z = x/norm, y/norm, z/norm
            
            # 转换到球面坐标
            theta = np.arccos(z)
            phi = np.arctan2(y, x)
            
            # 采样
            lat_idx = int(theta / np.pi * nlat)
            lon_idx = int(phi / (2*np.pi) * nlon)
            
            if 0 <= lat_idx < nlat and 0 <= lon_idx < nlon:
                planar[i, j] = spherical_image[lat_idx, lon_idx]
    
    return planar
```

### 4.3 直接在球面处理

**优势**：
- 避免投影畸变
- 保持几何一致性
- 360度统一处理

---

## 五、总结

### 5.1 核心贡献

1. **球面小波**：扩展小波到球面
2. **球面TV**：变分方法在球面
3. **应用拓展**：处理球面数据

### 5.2 与系列论文的关系

```
[2-08] 小波框架: 平面小波
[4-12] 球面小波: 球面扩展

推广: 欧氏空间 → 流形
```

### 5.3 关键公式

| 概念 | 公式 |
|:---|:---|
| 球面拉普拉斯 | $\Delta_S f = \frac{1}{\sin\theta}\partial_\theta(\sin\theta \partial_\theta f) + \frac{1}{\sin^2\theta}\partial_\phi^2 f$ |
| 球面TV | $TV_S(u) = \int_{S^2} |\nabla_S u| d\Omega$ |
| 球谐展开 | $f = \sum_{l,m} a_{lm} Y_l^m$ |

---

## 六、自测题

### 基础题

1. **解释**：为什么标准卷积不适用于球面数据？

2. **推导**：推导球面梯度的表达式。

3. **实现**：完成 `compute_spherical_gradient` 函数。

### 进阶题


5. **讨论**：球面方法与平面方法的trade-off。

---

**本精读笔记完成日期**：2026年2月  
**字数**：约8,500字

**特殊几何域的处理方法！**
